{"version":3,"sources":["webpack://chessalyzer/webpack/universalModuleDefinition","webpack://chessalyzer/webpack/bootstrap","webpack://chessalyzer/./src/ChessBoard.js","webpack://chessalyzer/./src/ChessPiece.js","webpack://chessalyzer/./src/ChessTile.js","webpack://chessalyzer/./src/Chessalyzer.js","webpack://chessalyzer/./src/GameProcessor.js","webpack://chessalyzer/./src/index.js","webpack://chessalyzer/external \"events\"","webpack://chessalyzer/external \"fs\"","webpack://chessalyzer/external \"line-by-line\"","webpack://chessalyzer/external \"perf_hooks\""],"names":["pawnTemplate","pieceTemplate","ChessBoard","cfg","stats","cntMoves","cntGames","setConfig","pieces","tiles","Array","row","currRow","col","push","initPiece","length","moveData","moves","takes","promotes","move","processTakes","processMove","promotePiece","to","logPieceHistory","logTileOccupation","updateTileStats","from","offset","piece","color","toPiece","fromPiece","killPiece","killedPiece","updateDeadCount","updatePosition","i","pos","resetPiece","defaultPos","reset","slice","initStats","coords","pieceType","alive","rowArray","name","console","log","config","Object","prototype","hasOwnProperty","call","updateOccupationStats","updateHistory","ChessPiece","promoted","history","histCol","cntMoved","at","movedTo","killedByPiece","cntWasKilled","killedBy","cntHasKilled","killed","ChessTile","defaultPiece","cntHasPiece","white","black","wasOnTile","cntTakenPieces","require","performance","fs","Chessalyzer","dataStore","gameProcessor","path","bank","refreshRate","Promise","resolve","t0","now","processPGN","then","board","dataset","JSON","parse","stringify","t1","tdiff","Math","round","mps","writeFile","err","error","readFileSync","square","fun","optData","algebraicToCoords","map","max","min","dataRow","j","bank1","bank2","data0","generateHeatmap","data1","a","b","list","val","toFixed","abs","sort","LineByLineReader","EventEmitter","files","GameProcessor","activePlayer","checkConfig","reject","lr","skipEmptyLines","game","processLine","line","startsWith","hasFilter","key","match","value","replace","split","filter","processGame","emit","close","end","resume","on","pause","parseMove","resetStats","rawMove","token","substring","preProcess","toLowerCase","pawnMove","pieceMove","castle","moveSan","direction","includes","parseInt","indexOf","tarRow","tarCol","mustBeInRow","mustBeInCol","findPiece","findLine","findDiag","findKnight","printPosition","obstructed1","obstructed2","row1","col1","row2","col2","checkCheck","opColor","king","isInCheck","diff","checkFor","srcTilePiece","tarTilePiece","obstructed","from1","from2","to1","to2","Infinity","temp"],"mappings":"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","file":"chessalyzer.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"chessalyzer\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"chessalyzer\"] = factory();\n\telse\n\t\troot[\"chessalyzer\"] = factory();\n})(global, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","import ChessTile from './ChessTile';\nimport ChessPiece from './ChessPiece';\n\nconst pawnTemplate = ['Pa', 'Pb', 'Pc', 'Pd', 'Pe', 'Pf', 'Pg', 'Ph'];\nconst pieceTemplate = ['Ra', 'Nb', 'Bc', 'Qd', 'Ke', 'Bf', 'Ng', 'Rh'];\n\n/** Class that contains the board status and tracks statistics. */\nclass ChessBoard {\n\t/** Creates a new 8x8 Chessboard out of 64 {@link ChessTile}s and 32 {@link ChessPiece}s */\n\tconstructor(cfg = {}) {\n\t\t/**\n\t\t * Tracks number of moves and games\n\t\t * @member {Object}\n\t\t */\n\t\tthis.stats = {\n\t\t\tcntMoves: 0,\n\t\t\tcntGames: 0\n\t\t};\n\n\t\tthis.cfg = {};\n\t\tthis.setConfig(cfg);\n\n\t\t/**\n\t\t * Contains all pieces on the board\n\t\t * @member {ChessPiece[]}\n\t\t */\n\t\tthis.pieces = [];\n\n\t\t/**\n\t\t * 8x8 array of {@link ChessTile}s\n\t\t * @member {Array[]}\n\t\t */\n\t\tthis.tiles = new Array(8);\n\t\tfor (let row = 0; row < 8; row += 1) {\n\t\t\tconst currRow = new Array(8);\n\t\t\tfor (let col = 0; col < 8; col += 1) {\n\t\t\t\tcurrRow[col] = new ChessTile();\n\n\t\t\t\t// init pieces\n\t\t\t\tif (row === 0 || row === 7) {\n\t\t\t\t\tthis.pieces.push(\n\t\t\t\t\t\tnew ChessPiece(pieceTemplate[col], [row, col])\n\t\t\t\t\t);\n\t\t\t\t\tcurrRow[col].initPiece(this.pieces[this.pieces.length - 1]);\n\t\t\t\t} else if (row === 1 || row === 6) {\n\t\t\t\t\tthis.pieces.push(\n\t\t\t\t\t\tnew ChessPiece(pawnTemplate[col], [row, col])\n\t\t\t\t\t);\n\t\t\t\t\tcurrRow[col].initPiece(this.pieces[this.pieces.length - 1]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.tiles[row] = currRow;\n\t\t}\n\t}\n\n\t/**\n\t * Moves a piece from source to target. Automatically handles the events 'move',\n\t *  'take', 'en passant', 'castle' and 'promote'.\n\t * Use this function instead of {@link ChessBoard#processMove} to input a move to the board!\n\t * @param {Object} moveData\n\t * @param {Object[]} moveData.moves - An array containing up to 2 moves in the\n\t *  syntax {from: [], to: []}\n\t * @param {Boolean} moveData.takes - True if the move takes a piece\n\t * @param {String} moveData.promotes - Type of promoted piece in case of pawn promotion, else null\n\t */\n\tmove(moveData) {\n\t\tif (moveData !== null) {\n\t\t\tthis.stats.cntMoves += 1;\n\n\t\t\tconst { moves } = moveData;\n\t\t\tconst { takes } = moveData;\n\t\t\tconst { promotes } = moveData;\n\n\t\t\t// move\n\t\t\tif (moves.length === 1) {\n\t\t\t\tconst move = moves[0];\n\n\t\t\t\tif (takes) {\n\t\t\t\t\tthis.processTakes(move);\n\t\t\t\t}\n\n\t\t\t\tthis.processMove(move);\n\n\t\t\t\tif (promotes !== null) {\n\t\t\t\t\tthis.promotePiece(move.to, promotes);\n\t\t\t\t}\n\t\t\t\t// castle\n\t\t\t} else {\n\t\t\t\tthis.processMove(moves[0]);\n\t\t\t\tthis.processMove(moves[1]);\n\t\t\t}\n\n\t\t\tif (this.cfg.logPieceHistory || this.cfg.logTileOccupation) {\n\t\t\t\tthis.updateTileStats();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Handles the 'takes' processing commanded by {@link ChessBoard#move}.\n\t * Don't call this function directly, use {@link ChessBoard#move} to input a move!\n\t * @private\n\t * @param {Object} move\n\t * @param {Number[]} move.from - Coordinates of start tile\n\t * @param {Number[]} move.to - Coordinates of target tile\n\t */\n\tprocessTakes(move) {\n\t\tconst { from } = move;\n\t\tconst { to } = move;\n\t\tlet offset = 0;\n\n\t\t// en passant\n\t\tif (this.tiles[to[0]][to[1]].piece === null) {\n\t\t\toffset =\n\t\t\t\tthis.tiles[from[0]][from[1]].piece.color === 'white' ? 1 : -1;\n\t\t}\n\t\tconst toPiece = this.tiles[to[0] + offset][to[1]].piece;\n\t\tconst fromPiece = this.tiles[from[0]][from[1]].piece;\n\n\t\ttoPiece.killPiece(fromPiece);\n\t\tfromPiece.killedPiece(toPiece);\n\n\t\tthis.tiles[to[0] + offset][to[1]].piece = null;\n\t\tthis.tiles[to[0] + offset][to[1]].updateDeadCount();\n\t}\n\n\t/**\n\t * Handles the 'move' processing commanded by {@link ChessBoard#move}.\n\t * Don't call this function directly, use {@link ChessBoard#move} to input a move!\n\t * @private\n\t * @param {Object} move\n\t * @param {Number[]} move.from - Coordinates of start tile\n\t * @param {Number[]} move.to - Coordinates of target tile\n\t */\n\tprocessMove(move) {\n\t\tconst { from } = move;\n\t\tconst { to } = move;\n\n\t\tthis.tiles[to[0]][to[1]].piece = this.tiles[from[0]][from[1]].piece;\n\t\tthis.tiles[to[0]][to[1]].piece.updatePosition(to);\n\t\tthis.tiles[from[0]][from[1]].piece = null;\n\t}\n\n\t/** Resets the board to the default state: removes promoted pieces and puts the standard\n\t *  pieces back to their starting positions.\n\t *\n\t *  Does not reset the stats recorded. If you wish to reset the stats,\n\t *  call {@link ChessBoard#resetStats}. */\n\treset() {\n\t\tthis.stats.cntGames += 1;\n\t\t// reset tiles and pieces to default\n\t\tfor (let i = 0; i < this.pieces.length; i += 1) {\n\t\t\tconst piece = this.pieces[i];\n\t\t\tthis.tiles[piece.pos[0]][piece.pos[1]].resetPiece();\n\t\t\tthis.tiles[piece.defaultPos[0]][piece.defaultPos[1]].resetPiece();\n\t\t\tpiece.reset();\n\t\t}\n\n\t\t// remove promoted pieces\n\t\tthis.pieces = this.pieces.slice(0, 32);\n\t}\n\n\t/** Resets the stats recorded. */\n\tresetStats() {\n\t\t// reset the tiles\n\t\tfor (let row = 0; row < 8; row += 1) {\n\t\t\tfor (let col = 0; col < 8; col += 1) {\n\t\t\t\tthis.tiles[row][col].initStats();\n\t\t\t}\n\t\t}\n\n\t\t// reset the pieces to default\n\t\tfor (let i = 0; i < this.pieces.length; i += 1) {\n\t\t\tthis.pieces[i].initStats();\n\t\t}\n\n\t\tthis.stats.cntMoves = 0;\n\t\tthis.stats.cntGames = 0;\n\t}\n\n\t/**\n\t * Promotes a pawn to a piece.\n\t * @private\n\t * @param {Number[]} coords An array containing the row and column of the pawn to be promoted.\n\t * @param {String} pieceType Target piece type in SAN notation ('N', 'B', 'Q', 'R').\n\t */\n\tpromotePiece(coords, pieceType) {\n\t\t// change alive directly instead of killPiece to not update stats\n\t\tthis.tiles[coords[0]][coords[1]].piece.alive = false;\n\t\tthis.tiles[coords[0]][coords[1]].piece = null;\n\n\t\tthis.pieces.push(\n\t\t\tnew ChessPiece(pieceType, [coords[0], coords[1]], true)\n\t\t);\n\t\tthis.tiles[coords[0]][coords[1]].piece = this.pieces[\n\t\t\tthis.pieces.length - 1\n\t\t];\n\t}\n\n\t/** Prints the current board position to the console. */\n\tprintPosition() {\n\t\tfor (let row = 0; row < 8; row += 1) {\n\t\t\tconst rowArray = [];\n\t\t\tfor (let col = 0; col < 8; col += 1) {\n\t\t\t\tconst { piece } = this.tiles[row][col];\n\t\t\t\tif (piece !== null) {\n\t\t\t\t\trowArray.push(piece.name);\n\t\t\t\t} else {\n\t\t\t\t\trowArray.push('..');\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(rowArray);\n\t\t}\n\t}\n\n\tsetConfig(config) {\n\t\tthis.cfg.logPieceHistory = Object.prototype.hasOwnProperty.call(\n\t\t\tconfig,\n\t\t\t'logPieceHistory'\n\t\t)\n\t\t\t? config.logPieceHistory\n\t\t\t: false;\n\t\tthis.cfg.logTileOccupation = Object.prototype.hasOwnProperty.call(\n\t\t\tconfig,\n\t\t\t'logTileOccupation'\n\t\t)\n\t\t\t? config.logTileOccupation\n\t\t\t: true;\n\t}\n\n\t/** Is called after each {@link ChessBoard#move} to record the stats for the ChessTiles.\n\t * Only every tile, that has a piece on it, is updated.\n\t * @private\n\t */\n\tupdateTileStats() {\n\t\tfor (let i = 0; i < 32; i += 1) {\n\t\t\tif (this.pieces[i].alive) {\n\t\t\t\tif (this.cfg.logTileOccupation) {\n\t\t\t\t\tthis.tiles[this.pieces[i].pos[0]][\n\t\t\t\t\t\tthis.pieces[i].pos[1]\n\t\t\t\t\t].updateOccupationStats();\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis.cfg.logPieceHistory &&\n\t\t\t\t\t((this.stats.cntMoves % 2 === 0 &&\n\t\t\t\t\t\tthis.pieces[i].color === 'black') ||\n\t\t\t\t\t\t(this.stats.cntMoves % 2 === 1 &&\n\t\t\t\t\t\t\tthis.pieces[i].color === 'white'))\n\t\t\t\t) {\n\t\t\t\t\tthis.pieces[i].updateHistory();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport default ChessBoard;\n","/**\n * Class that represents a chess piece and tracks statistics.\n */\nclass ChessPiece {\n\t/**\n\t * Creates a new ChessPiece.\n\t * @param {String} piece The name of the piece, e.g. 'Pd' for a D pawn.\n\t * @param {Number[]} pos Row and column the piece is on at start.\n\t * @param {Boolean} [promoted=false] Denotes if this piece is created by pawn promotion.\n\t */\n\tconstructor(piece, pos, promoted = false) {\n\t\t/**\n\t\t * Name of the piece, e.g 'Pb' for the b pawn\n\t\t * @member {String}\n\t\t */\n\t\tthis.name = piece; // piece type\n\n\t\t/**\n\t\t * Current position of this piece: [row,col], with [0,0] being the top left square\n\t\t * @member {Number[]}\n\t\t */\n\t\tthis.pos = pos; // current position in [row, col] notation\n\n\t\t/**\n\t\t * Starting position of this piece: [row,col], with [0,0] being the top left square\n\t\t * @member {Number[]}\n\t\t */\n\t\tthis.defaultPos = pos; // starting position of this piece\n\n\t\t/**\n\t\t * Color of this piece: 'black' or 'white'\n\t\t * @member {String}\n\t\t */\n\t\tthis.color = '';\n\t\tif (promoted) {\n\t\t\tthis.color = this.defaultPos[0] <= 1 ? 'white' : 'black'; // color of piece: 0 white, 1 black\n\t\t} else {\n\t\t\tthis.color = this.defaultPos[0] <= 1 ? 'black' : 'white'; // color of piece: 0 white, 1 black\n\t\t}\n\n\t\tthis.alive = true; // piece alive?\n\n\t\t/**\n\t\t * Object that contains the tracked statistics\n\t\t * @member {Object}\n\t\t */\n\t\tthis.stats = {};\n\n\t\t/**\n\t\t * Is this piece alive?\n\t\t * @member {Object}\n\t\t */\n\n\t\tthis.initStats();\n\n\t\t// option to track the move history of each piece\n\t\t// currently unused, costs a lot of performance\n\t\tthis.history = []; // position history\n\n\t\tthis.histCol = [];\n\t}\n\n\t/**\n\t * Resets this piece to its default position and denotes a new game in the move history tracker.\n\t * @private\n\t */\n\treset() {\n\t\tif (this.histCol.length > 0) {\n\t\t\tthis.history.push(this.histCol);\n\t\t\tthis.histCol = [];\n\t\t}\n\n\t\tthis.pos = this.defaultPos;\n\t\tthis.alive = true;\n\t}\n\n\t/**\n\t * Moves this piece to a new position and updates move statistics.\n\t * @private\n\t * @param {Number[]} pos Target row and column of the tile the piece shall move to.\n\t */\n\tupdatePosition(pos) {\n\t\tthis.stats.cntMoved += 1;\n\t\tthis.pos = pos;\n\t\tthis.stats.at[pos[0]][pos[1]].movedTo += 1;\n\t}\n\n\tupdateHistory() {\n\t\tthis.histCol.push(this.pos);\n\t}\n\n\t/**\n\t * Marks this piece as taken and updates the statistics of the piece it was taken by.\n\t * @private\n\t * @param {ChessPiece} killedBy Piece this piece was taken by.\n\t */\n\tkillPiece(killedByPiece) {\n\t\tthis.alive = false;\n\t\tthis.stats.cntWasKilled += 1;\n\n\t\t// if killer is not promoted pawn...\n\t\tif (!(killedByPiece.name.length === 1 || this.name.length === 1)) {\n\t\t\t// update killedBy of this piece\n\t\t\tthis.stats.at[killedByPiece.defaultPos[0]][\n\t\t\t\tkilledByPiece.defaultPos[1]\n\t\t\t].killedBy += 1;\n\t\t}\n\t}\n\n\tkilledPiece(killedPiece) {\n\t\tthis.stats.cntHasKilled += 1;\n\n\t\t// if killer is not promoted pawn...\n\t\tif (!(killedPiece.name.length === 1 || this.name.length === 1)) {\n\t\t\t// update killed stat of killer piece\n\t\t\tthis.stats.at[killedPiece.defaultPos[0]][\n\t\t\t\tkilledPiece.defaultPos[1]\n\t\t\t].killed += 1;\n\t\t}\n\t}\n\n\t/**\n\t * Inits the statistics array of this piece.\n\t * @private\n\t */\n\tinitStats() {\n\t\tthis.stats = { cntMoved: 0, cntWasKilled: 0, cntHasKilled: 0 };\n\t\tthis.stats.at = new Array(8);\n\t\tfor (let row = 0; row < 8; row += 1) {\n\t\t\tconst currRow = new Array(8);\n\t\t\tfor (let col = 0; col < 8; col += 1) {\n\t\t\t\tcurrRow[col] = { movedTo: 0, killedBy: 0, killed: 0 };\n\t\t\t}\n\t\t\tthis.stats.at[row] = currRow;\n\t\t}\n\t}\n}\n\nexport default ChessPiece;\n","/** Class that represents a single Tile. Tracks statistics for itself. */\nclass ChessTile {\n\t/** Creates a new Tile. */\n\tconstructor() {\n\t\t/**\n\t\t * Piece that is currently on this tile.\n\t\t * @member {ChessPiece}\n\t\t */\n\t\tthis.piece = null;\n\n\t\t/**\n\t\t * Piece that is on this tile at start of game.\n\t\t * @member {ChessPiece}\n\t\t */\n\t\tthis.defaultPiece = null;\n\n\t\t/**\n\t\t * Object that contains the tracked statistics\n\t\t * @member {Object}\n\t\t */\n\t\tthis.stats = {};\n\n\t\tthis.initStats();\n\t}\n\n\t/**\n\t * Places a piece on this tile. Should only be called at board init.\n\t * @private\n\t * @param {ChessPiece} piece The piece that is on this square by default.\n\t */\n\tinitPiece(piece) {\n\t\tthis.piece = piece;\n\t\tthis.defaultPiece = piece;\n\t}\n\n\t/**\n\t * Sets the currently active piece of this square to the default piece.\n\t * @private\n\t */\n\tresetPiece() {\n\t\tthis.piece = this.defaultPiece;\n\t}\n\n\t/**\n\t * Updates the statistics of this tile.\n\t * @private\n\t */\n\tupdateOccupationStats() {\n\t\t// this.stats.cntHasPiece[this.piece.color] is slow for some reason, so use if\n\t\tif (this.piece.color === 'white') {\n\t\t\tthis.stats.cntHasPiece.white += 1;\n\t\t} else {\n\t\t\tthis.stats.cntHasPiece.black += 1;\n\t\t}\n\n\t\t// only non-promoted pieces are counted\n\t\tif (this.piece.name.length !== 1) {\n\t\t\tthis.stats.at[this.piece.defaultPos[0]][\n\t\t\t\tthis.piece.defaultPos[1]\n\t\t\t].wasOnTile += 1;\n\t\t}\n\t}\n\n\tupdateDeadCount() {\n\t\tthis.stats.cntTakenPieces += 1;\n\t}\n\n\t/**\n\t * Inits the statistics array. Is called by the constructor.\n\t * @private\n\t */\n\tinitStats() {\n\t\tthis.stats.cntHasPiece = { white: 0, black: 0 };\n\t\tthis.stats.cntTakenPieces = 0;\n\n\t\tthis.stats.at = new Array(8);\n\t\tfor (let row = 0; row < 8; row += 1) {\n\t\t\tconst currRow = new Array(8);\n\t\t\tfor (let col = 0; col < 8; col += 1) {\n\t\t\t\tcurrRow[col] = { wasOnTile: 0 };\n\t\t\t}\n\t\t\tthis.stats.at[row] = currRow;\n\t\t}\n\t}\n}\n\nexport default ChessTile;\n","import GameProcessor from './GameProcessor';\n\nconst { performance } = require('perf_hooks');\n\nconst fs = require('fs');\n\nconst pawnTemplate = ['Pa', 'Pb', 'Pc', 'Pd', 'Pe', 'Pf', 'Pg', 'Ph'];\nconst pieceTemplate = ['Ra', 'Nb', 'Bc', 'Qd', 'Ke', 'Bf', 'Ng', 'Rh'];\n\n/**\n * @typedef {Object} cfg\n * @property {Function} filter - Descr\n * @property {Number} cntGames - Descr\n * @property {Boolean} split - Descr\n */\n\n/** Main class for batch processing and generating heat maps */\nclass Chessalyzer {\n\tconstructor() {\n\t\t/**\n\t\t * Contains the tracked data of the processed PGN files. Has two different banks for\n\t\t * heat map comparison. Each object contains the following keys:\n\t\t * <ul>\n\t\t * <li>data: {cntMoves, cntGames}. Information about the count of processed moves and games</li>\n\t\t * <li>tiles: 8x8 array of {@link ChessTile}s.</li>\n\t\t * </ul>\n\t\t * @member {Object[]}\n\t\t */\n\t\tthis.dataStore = new Array(2);\n\t\t/**\n\t\t * Does the analysis part\n\t\t * @private\n\t\t * @member {GameProcessor}\n\t\t */\n\t\tthis.gameProcessor = new GameProcessor();\n\t}\n\n\t/**\n\t * Starts the batch processing for the selected file\n\t * @param {String} path - Path to the PGN file that should be analyzed\n\t * @param {Object} [cfg = {}]\n\t * @param {Function} [cfg.filter = ()=>true] - Filter function for selecting games\n\t * @param {Number} [cfg.cntGames = Infinite ] - Max amount of games to process\n\t * @param {Object} cfg.stats - Configuration for data aquisition\n\t * @param {Boolean} [cfg.stats.logPieceHistory = false] - Option for logging the position\n\t * of every piece.\n\t * @param {Boolean} [cfg.stats.logTileOccupation = true] - Option for logging the piece\n\t * on every tile after every move.\n\t * @param {Number} [bank = 0] - The data bank the results shall be saved to\n\t * @param {Number} [refreshRate = 250] - Defines how often the current status of the\n\t *  analysis shall be exposed. Every number of processed games an event is emitted\n\t *  containing the current number of processed games. The event can be handled via\n\t *  \"chessalyzer.gameProcessor.on('status', function(gameCnt) {// do handling here});\",\n\t *  e.g. to update an UI.\n\t * @returns {Promise} Promise that contains the number of processed games when finished\n\t */\n\tstartBatch(path, cfg = {}, bank = 0, refreshRate = 250) {\n\t\treturn new Promise((resolve) => {\n\t\t\tconst t0 = performance.now();\n\t\t\tthis.gameProcessor\n\t\t\t\t.processPGN(path, cfg, refreshRate)\n\t\t\t\t.then((board) => {\n\t\t\t\t\tconst dataset = {};\n\t\t\t\t\tdataset.stats = board.stats;\n\t\t\t\t\tdataset.tiles = board.tiles;\n\t\t\t\t\tthis.dataStore[bank] = JSON.parse(JSON.stringify(dataset));\n\t\t\t\t\tconst t1 = performance.now();\n\t\t\t\t\tconst tdiff = Math.round(t1 - t0) / 1000;\n\t\t\t\t\tconst mps = Math.round(dataset.stats.cntMoves / tdiff);\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t`${dataset.stats.cntGames} games (${\n\t\t\t\t\t\t\tdataset.stats.cntMoves\n\t\t\t\t\t\t} moves) processed in ${tdiff}s (${mps} moves/s)`\n\t\t\t\t\t);\n\t\t\t\t\tthis.gameProcessor.reset();\n\t\t\t\t\tresolve(this.dataStore[bank].stats.cntGames);\n\t\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Saves a completed batch run to a JSON file\n\t * @param {String} path - Path the data file shall be saved to\n\t * @param {Number} [bank = 0] - The data bank the data shall be taken from\n\t */\n\tsaveData(path, bank = 0) {\n\t\tfs.writeFile(path, JSON.stringify(this.dataStore[bank]), (err) => {\n\t\t\tif (err) {\n\t\t\t\tconsole.error(err);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconsole.log('File has been created');\n\t\t});\n\t}\n\n\t/**\n\t * Loads the stats of a previous batch run (JSON) to a data bank\n\t * @param {String} path - Path the data file shall be loaded from\n\t * @param {Number} [bank = 0] - The data bank the data shall be loaded to.\n\t * @returns {Number} Count of loaded games\n\t */\n\tloadData(path, bank) {\n\t\tthis.dataStore[bank] = JSON.parse(fs.readFileSync(path, 'utf8'));\n\t\tconsole.log(`File '${path}' has been loaded to bank ${bank}.`);\n\t\treturn this.dataStore[bank].cntGames;\n\t}\n\n\t/**\n\t * Generates a heatmap out of the tracked data.\n\t * @param {Number} bank - The data bank the data shall be taken from\n\t * @param {String} square - The square the data shall be generated for. For example, if you\n\t * wanted to know how often a specific piece was on a specific tile, you would pass the\n\t * identifier of the tile to the function, e.g. \"a2\"\n\t * @param {Function} fun - The evaluation function that generates the heatmap out of the\n\t * saved data. This function gets passed the following arguments:\n\t * <ol>\n\t * <li>The complete data stored in the chosen bank. See the member description of the dataStore\n\t * member to see which data is available.</li>\n\t * <li>The coords of the tile passed as the 'square' argument.</li>\n\t * <li>The current coordinates of the tile the data should be generated for.\n\t * The function must return a Number with the heat map value for the square passed as the\n\t * third argument.</li>\n\t * <li>An optional data field, you passed for 'optData'</li>\n\t * </ol>\n\t * See ./src/exampleHeatmapConfig for examples of such a function.\n\t * @param {} optData - Optional data you may need in your eval function\n\t * @returns {Array} Array with 3 entries:\n\t * <ol>\n\t * <li>8x8 Array containing the heat map values for each tile</li>\n\t * <li>The minimum value in the heatmap.</li>\n\t * <li>The maximum value in the heatmap.</li>\n\t * </ol>\n\t */\n\tgenerateHeatmap(bank, square, fun, optData) {\n\t\tconst coords = GameProcessor.algebraicToCoords(square);\n\t\tconst map = [];\n\t\tlet max = 0;\n\t\tlet min = 1000000;\n\n\t\tfor (let i = 0; i < 8; i += 1) {\n\t\t\tconst dataRow = new Array(8);\n\t\t\tfor (let j = 0; j < 8; j += 1) {\n\t\t\t\tdataRow[j] = fun(this.dataStore[bank], coords, [i, j], optData);\n\t\t\t\tif (dataRow[j] > max) max = dataRow[j];\n\t\t\t\tif (dataRow[j] < min) min = dataRow[j];\n\t\t\t}\n\t\t\tmap.push(dataRow);\n\t\t}\n\n\t\treturn [map, min, max];\n\t}\n\n\t/**\n\t * Generates a comparison heatmap out of the tracked data. There needs to data in both\n\t * banks you pass as bank1 and bank2 params. The heatmap for both banks are calculated\n\t * and then the relative differences between both banks are calculated. For example,\n\t * if the heatmap value for \"a1\" of bank1 is 10 and the value of bank2 is 5, the returned\n\t * value for \"a1\" would be 100% ([[10/5] -1] *100).\n\t * @param {String} square - The square the data shall be generated for.\n\t * @param {Function} fun - The evaluation function that generates the heatmap out of the\n\t * saved data. See {@link Chessalyzer#generateHeatmap} for a more detailed description.\n\t * @param {Number} [bank1 = 0] - Bank number of dataset 1\n\t * @param {Number} [bank2 = 1] - Bank number of dataset 2\n\t * @param {} optData - Optional data you may need in your eval function\n\t * @returns {Array} Array with 3 entries:\n\t * <ol>\n\t * <li>8x8 Array containing the heat map values for each tile</li>\n\t * <li>The minimum value in the heatmap.</li>\n\t * <li>The maximum value in the heatmap.</li>\n\t * </ol>\n\t */\n\tgenerateComparisonHeatmap(square, fun, bank1 = 0, bank2 = 1, optData) {\n\t\tconst map = [];\n\t\tlet max = 0;\n\t\tlet min = 100000;\n\n\t\t// comparison heatmap\n\t\tconst data0 = this.generateHeatmap(bank1, square, fun, optData);\n\t\tconst data1 = this.generateHeatmap(bank2, square, fun, optData);\n\n\t\tfor (let i = 0; i < 8; i += 1) {\n\t\t\tconst dataRow = new Array(8);\n\t\t\tfor (let j = 0; j < 8; j += 1) {\n\t\t\t\tconst a = data0[0][i][j];\n\t\t\t\tconst b = data1[0][i][j];\n\t\t\t\tif (a === 0 || b === 0) dataRow[j] = 0;\n\t\t\t\telse dataRow[j] = (a >= b ? a / b - 1 : -b / a + 1) * 100;\n\n\t\t\t\tif (dataRow[j] > max) max = dataRow[j];\n\t\t\t\tif (dataRow[j] < min) min = dataRow[j];\n\t\t\t}\n\t\t\tmap.push(dataRow);\n\t\t}\n\n\t\treturn [map, min, max];\n\t}\n\n\tstatic generateList(map) {\n\t\tconst list = [];\n\t\tfor (let i = 0; i < 8; i += 1) {\n\t\t\tfor (let j = 0; j < 8; j += 1) {\n\t\t\t\tlet val = map[i][j];\n\t\t\t\tval = val.toFixed(2);\n\t\t\t\tif (Math.abs(val) > 0.001) {\n\t\t\t\t\tif (i === 0) list.push([`b${pieceTemplate[j]}`, val]);\n\t\t\t\t\telse if (i === 1) list.push([`b${pawnTemplate[j]}`, val]);\n\t\t\t\t\telse if (i === 6) list.push([`w${pawnTemplate[j]}`, val]);\n\t\t\t\t\telse if (i === 7) list.push([`w${pieceTemplate[j]}`, val]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlist.sort((a, b) => b[1] - a[1]);\n\t\treturn list;\n\t}\n}\n\nexport default Chessalyzer;\n","import ChessBoard from './ChessBoard';\n\nconst LineByLineReader = require('line-by-line');\nconst EventEmitter = require('events');\n\nconst files = 'abcdefgh';\n\n/**\n * Class that processes games.\n */\nclass GameProcessor extends EventEmitter {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.board = new ChessBoard();\n\t\tthis.activePlayer = 0;\n\t}\n\n\tstatic checkConfig(config) {\n\t\tconst cfg = {};\n\t\tcfg.hasFilter = Object.prototype.hasOwnProperty.call(config, 'filter');\n\t\tcfg.filter = cfg.hasFilter ? config.filter : () => true;\n\n\t\tcfg.cntGames = Object.prototype.hasOwnProperty.call(config, 'cntGames')\n\t\t\t? config.cntGames\n\t\t\t: Infinity;\n\n\t\tcfg.stats = Object.prototype.hasOwnProperty.call(config, 'stats')\n\t\t\t? config.stats\n\t\t\t: {};\n\n\t\t// TODO: currently without function\n\t\tcfg.split = Object.prototype.hasOwnProperty.call(config, 'split')\n\t\t\t? config.split\n\t\t\t: false;\n\n\t\treturn cfg;\n\t}\n\n\tprocessPGN(path, config, refreshRate) {\n\t\tconst cfg = GameProcessor.checkConfig(config);\n\n\t\tthis.board.setConfig(cfg.stats);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst lr = new LineByLineReader(path, { skipEmptyLines: true });\n\t\t\tlet game = {};\n\n\t\t\t// process current line\n\t\t\tconst processLine = (line) => {\n\t\t\t\t// data tag\n\t\t\t\tif (line.startsWith('[') && cfg.hasFilter) {\n\t\t\t\t\tconst key = line.match(/\\[(.*?)\\s/)[1];\n\t\t\t\t\tconst value = line.match(/\"(.*?)\"/)[1];\n\n\t\t\t\t\tgame[key] = value;\n\n\t\t\t\t\t// moves\n\t\t\t\t} else if (line.startsWith('1')) {\n\t\t\t\t\tgame.moves = line\n\t\t\t\t\t\t.replace(/\\{(.*?)\\}\\s/g, '')\n\t\t\t\t\t\t.replace(/\\d+\\.+\\s/g, '')\n\t\t\t\t\t\t.replace(' *', '')\n\t\t\t\t\t\t.split(' ');\n\n\t\t\t\t\tif (cfg.filter(game) || !cfg.hasFilter) {\n\t\t\t\t\t\tthis.processGame(game);\n\t\t\t\t\t}\n\n\t\t\t\t\t// emit event\n\t\t\t\t\tif (this.board.stats.cntGames % refreshRate === 0) {\n\t\t\t\t\t\tthis.emit('status', this.board.stats.cntGames);\n\t\t\t\t\t}\n\n\t\t\t\t\tgame = {};\n\t\t\t\t}\n\t\t\t\tif (this.board.stats.cntGames >= cfg.cntGames) {\n\t\t\t\t\tlr.close();\n\t\t\t\t\tlr.end();\n\t\t\t\t} else {\n\t\t\t\t\tlr.resume();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tlr.on('error', (err) => {\n\t\t\t\tconsole.log(err);\n\t\t\t\treject();\n\t\t\t});\n\n\t\t\tlr.on('line', (line) => {\n\t\t\t\t// pause emitting of lines...\n\t\t\t\tlr.pause();\n\n\t\t\t\tprocessLine(line);\n\t\t\t});\n\n\t\t\tlr.on('end', () => {\n\t\t\t\tconsole.log('Read entire file.');\n\t\t\t\tresolve(this.board);\n\t\t\t});\n\t\t});\n\t}\n\n\tprocessGame(game) {\n\t\tconst { moves } = game;\n\n\t\tfor (let i = 0; i < moves.length; i += 1) {\n\t\t\tthis.activePlayer = i % 2;\n\t\t\tconst moveData = this.parseMove(moves[i]);\n\t\t\tthis.board.move(moveData);\n\t\t}\n\t\tthis.board.reset();\n\t}\n\n\treset() {\n\t\tthis.board.reset();\n\t\tthis.board.resetStats();\n\t\tthis.activePlayer = 0;\n\t}\n\n\t/**\n\t * @typedef {Object} MoveData\n\t * @property {Object[]} moves - Array of {from: [], to: []} objects\n\t * @property {Boolean} takes - Move takes a piece true/false\n\t * @property {String} promotes - Piece type in case of pawn promotion else null\n\t */\n\n\t/**\n\t * Parses a move in string format to board coordinates. Wrapper function for\n\t *  the different move algorithms.\n\t * @param {string} rawMove The move to be parsed, e.g. 'Ne5+'.\n\t * @returns {MoveData}\n\t */\n\tparseMove(rawMove) {\n\t\tconst token = rawMove.substring(0, 1);\n\t\tlet moveData = {};\n\n\t\tconst move = GameProcessor.preProcess(rawMove);\n\n\t\t// game end on '1-0', '0-1' or '1/2-1/2' (check for digit as first char)\n\t\tif (token.match(/\\d/) !== null) {\n\t\t\tmoveData = null;\n\t\t} else if (token.toLowerCase() === token) {\n\t\t\tmoveData = this.pawnMove(move);\n\t\t} else if (token !== 'O') {\n\t\t\tmoveData = this.pieceMove(move);\n\t\t} else {\n\t\t\tmoveData = this.castle(move);\n\t\t}\n\n\t\treturn moveData;\n\t}\n\n\t/**\n\t * Returns the board coordinates for the move if it is a pawn move.\n\t * @param {string} moveSan The move to be parsed, e.g. 'e5'.\n\t * @returns {MoveData}\n\t */\n\tpawnMove(moveSan) {\n\t\tconst from = [];\n\t\tconst to = [];\n\t\tconst moveData = {\n\t\t\tmoves: [],\n\t\t\ttakes: false,\n\t\t\tpromotes: null\n\t\t};\n\t\tconst direction = -2 * (this.activePlayer % 2) + 1;\n\t\tlet move = moveSan;\n\n\t\t// takes\n\t\tif (move.includes('x')) {\n\t\t\tmoveData.takes = true;\n\t\t\tmove = move.replace('x', '');\n\n\t\t\tto[0] = 8 - parseInt(move.substring(2, 3), 10);\n\t\t\tto[1] = files.indexOf(move.substring(1, 2));\n\t\t\tfrom[0] = to[0] + direction;\n\t\t\tfrom[1] = files.indexOf(move.substring(0, 1));\n\n\t\t\t// moves\n\t\t} else {\n\t\t\tconst tarRow = 8 - parseInt(move.substring(1, 2), 10);\n\t\t\tconst tarCol = files.indexOf(move.substring(0, 1));\n\n\t\t\tfrom[1] = tarCol;\n\t\t\tto[0] = tarRow;\n\t\t\tto[1] = tarCol;\n\t\t\tfor (let i = tarRow + direction; i < 8 && i >= 0; i += direction) {\n\t\t\t\tif (this.board.tiles[i][tarCol].piece !== null) {\n\t\t\t\t\tif (this.board.tiles[i][tarCol].piece.name.includes('P')) {\n\t\t\t\t\t\tfrom[0] = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tmoveData.moves.push({ from, to });\n\n\t\t// promotes\n\t\tif (move.includes('=')) {\n\t\t\tmoveData.promotes = move.substring(move.length - 1, move.length);\n\t\t}\n\n\t\treturn moveData;\n\t}\n\n\t/**\n\t * Returns the board coordinates for a piece (!= pawn) move.\n\t * @param {string} moveSan The move to be parsed, e.g. 'Be3'.\n\t * @returns {MoveData}\n\t */\n\tpieceMove(moveSan) {\n\t\tconst from = [];\n\t\tconst to = [];\n\t\tconst moveData = {\n\t\t\tmoves: [],\n\t\t\ttakes: false,\n\t\t\tpromotes: null\n\t\t};\n\t\tlet move = moveSan;\n\t\tconst token = move.substring(0, 1);\n\n\t\t// remove token\n\t\tmove = move.substring(1, move.length);\n\n\t\t// takes\n\t\tif (move.includes('x')) {\n\t\t\tmoveData.takes = true;\n\t\t\tmove = move.replace('x', '');\n\t\t}\n\n\t\t// e.g. Re3f5\n\t\tif (move.length === 4) {\n\t\t\tfrom[0] = 8 - parseInt(move.substring(1, 2), 10);\n\t\t\tfrom[1] = files.indexOf(move.substring(0, 1));\n\t\t\tto[0] = 8 - parseInt(move.substring(3, 4), 10);\n\t\t\tto[1] = files.indexOf(move.substring(2, 3));\n\t\t\tmoveData.moves.push({ from, to });\n\n\t\t\t// e.g. Ref3\n\t\t} else if (move.length === 3) {\n\t\t\tconst tarRow = 8 - parseInt(move.substring(2, 3), 10);\n\t\t\tconst tarCol = files.indexOf(move.substring(1, 2));\n\t\t\tlet mustBeInRow = -1;\n\t\t\tlet mustBeInCol = -1;\n\n\t\t\t// file is specified\n\t\t\tif (files.indexOf(move.substring(0, 1)) >= 0) {\n\t\t\t\tmustBeInCol = files.indexOf(move.substring(0, 1));\n\n\t\t\t\t// rank is specified\n\t\t\t} else {\n\t\t\t\tmustBeInRow = 8 - parseInt(move.substring(0, 1), 10);\n\t\t\t}\n\t\t\tmoveData.moves.push(\n\t\t\t\tthis.findPiece(tarRow, tarCol, mustBeInRow, mustBeInCol, token)\n\t\t\t);\n\n\t\t\t// e.g. Rf3\n\t\t} else {\n\t\t\tconst tarRow = 8 - parseInt(move.substring(1, 2), 10);\n\t\t\tconst tarCol = files.indexOf(move.substring(0, 1));\n\t\t\tmoveData.moves.push(this.findPiece(tarRow, tarCol, -1, -1, token));\n\t\t}\n\n\t\treturn moveData;\n\t}\n\n\t/**\n\t * Wrapper function for different piece search algorithms.\n\t * @param {number} tarRow Target row for piece move.\n\t * @param {number} tarCol Target column for piece move.\n\t * @param {number} mustBeInRow Moving piece must be in this row. '-1' if unknown.\n\t * @param {number} mustBeInCol Moving piece must be in this column. '-1' if unknown.\n\t * @param {string} token Moving piece must be of this type, e.g 'R'.\n\t * @returns {Object}\n\t */\n\tfindPiece(tarRow, tarCol, mustBeInRow, mustBeInCol, token) {\n\t\tlet move;\n\n\t\tif (token === 'R') {\n\t\t\tmove = this.findLine(\n\t\t\t\ttarRow,\n\t\t\t\ttarCol,\n\t\t\t\tmustBeInRow,\n\t\t\t\tmustBeInCol,\n\t\t\t\ttoken\n\t\t\t);\n\t\t} else if (token === 'B') {\n\t\t\tmove = this.findDiag(\n\t\t\t\ttarRow,\n\t\t\t\ttarCol,\n\t\t\t\tmustBeInRow,\n\t\t\t\tmustBeInCol,\n\t\t\t\ttoken\n\t\t\t);\n\t\t} else if (token === 'Q' || token === 'K') {\n\t\t\tmove = this.findDiag(\n\t\t\t\ttarRow,\n\t\t\t\ttarCol,\n\t\t\t\tmustBeInRow,\n\t\t\t\tmustBeInCol,\n\t\t\t\ttoken\n\t\t\t);\n\t\t\tif (move.from[0] === -1) {\n\t\t\t\tmove = this.findLine(\n\t\t\t\t\ttarRow,\n\t\t\t\t\ttarCol,\n\t\t\t\t\tmustBeInRow,\n\t\t\t\t\tmustBeInCol,\n\t\t\t\t\ttoken\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (token === 'N') {\n\t\t\tmove = this.findKnight(\n\t\t\t\ttarRow,\n\t\t\t\ttarCol,\n\t\t\t\tmustBeInRow,\n\t\t\t\tmustBeInCol,\n\t\t\t\ttoken\n\t\t\t);\n\t\t}\n\t\tif (move.from[0] === -1) {\n\t\t\tconsole.log(\n\t\t\t\t`Error: no piece for move ${token} to (${tarRow},${tarCol}) found!`\n\t\t\t);\n\t\t\tthis.board.printPosition();\n\t\t}\n\n\t\treturn move;\n\t}\n\n\t/**\n\t * Search algorithm to find a piece that can move diagonally.\n\t * @param {number} tarRow Target row for piece move.\n\t * @param {number} tarCol Target column for piece move.\n\t * @param {number} mustBeInRow Moving piece must be in this row. '-1' if unknown.\n\t * @param {number} mustBeInCol Moving piece must be in this column. '-1' if unknown.\n\t * @param {string} token Moving piece must be of this type, e.g 'R'.\n\t * @returns {Object}\n\t */\n\tfindDiag(tarRow, tarCol, mustBeInRow, mustBeInCol, token) {\n\t\tconst color = this.activePlayer % 2 ? 'black' : 'white';\n\n\t\tconst from = [];\n\t\tconst to = [];\n\t\tfrom[0] = -1;\n\t\tfrom[1] = -1;\n\t\tto[0] = tarRow;\n\t\tto[1] = tarCol;\n\n\t\tfor (let i = -1; i <= 1; i += 2) {\n\t\t\tlet obstructed1 = false;\n\t\t\tlet obstructed2 = false;\n\t\t\tfor (let j = 1; j < 8; j += 1) {\n\t\t\t\tconst row1 = to[0] + i * j;\n\t\t\t\tconst col1 = to[1] + j;\n\t\t\t\tconst row2 = to[0] - i * j;\n\t\t\t\tconst col2 = to[1] - j;\n\n\t\t\t\tif (\n\t\t\t\t\trow1 >= 0 &&\n\t\t\t\t\trow1 < 8 &&\n\t\t\t\t\tcol1 >= 0 &&\n\t\t\t\t\tcol1 < 8 &&\n\t\t\t\t\t!obstructed1 &&\n\t\t\t\t\tthis.board.tiles[row1][col1].piece !== null\n\t\t\t\t) {\n\t\t\t\t\tconst { piece } = this.board.tiles[row1][col1];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row1 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col1 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row1, col1], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row1;\n\t\t\t\t\t\t\tfrom[1] = col1;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobstructed1 = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\trow2 >= 0 &&\n\t\t\t\t\trow2 < 8 &&\n\t\t\t\t\tcol2 >= 0 &&\n\t\t\t\t\tcol2 < 8 &&\n\t\t\t\t\t!obstructed2 &&\n\t\t\t\t\tthis.board.tiles[row2][col2].piece !== null\n\t\t\t\t) {\n\t\t\t\t\tconst { piece } = this.board.tiles[row2][col2];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row2 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col2 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row2, col2], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row2;\n\t\t\t\t\t\t\tfrom[1] = col2;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobstructed2 = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn { from, to };\n\t}\n\n\t/**\n\t * Search algorithm to find a piece that can move vertically/horizontally.\n\t * @param {number} tarRow Target row for piece move.\n\t * @param {number} tarCol Target column for piece move.\n\t * @param {number} mustBeInRow Moving piece must be in this row. '-1' if unknown.\n\t * @param {number} mustBeInCol Moving piece must be in this column. '-1' if unknown.\n\t * @param {string} token Moving piece must be of this type, e.g 'R'.\n\t * @returns {Object}\n\t */\n\tfindLine(tarRow, tarCol, mustBeInRow, mustBeInCol, token) {\n\t\tconst color = this.activePlayer % 2 ? 'black' : 'white';\n\t\tconst from = [];\n\t\tconst to = [];\n\t\tfrom[0] = -1;\n\t\tfrom[1] = -1;\n\t\tto[0] = tarRow;\n\t\tto[1] = tarCol;\n\n\t\tfor (let i = -1; i <= 1; i += 2) {\n\t\t\tlet obstructed1 = false;\n\t\t\tlet obstructed2 = false;\n\t\t\tfor (let j = 1; j < 8; j += 1) {\n\t\t\t\tconst row1 = to[0];\n\t\t\t\tconst col1 = to[1] - i * j;\n\t\t\t\tconst row2 = to[0] - i * j;\n\t\t\t\tconst col2 = to[1];\n\n\t\t\t\tif (\n\t\t\t\t\trow1 >= 0 &&\n\t\t\t\t\trow1 < 8 &&\n\t\t\t\t\tcol1 >= 0 &&\n\t\t\t\t\tcol1 < 8 &&\n\t\t\t\t\t!obstructed1 &&\n\t\t\t\t\tthis.board.tiles[row1][col1].piece !== null\n\t\t\t\t) {\n\t\t\t\t\tconst { piece } = this.board.tiles[row1][col1];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row1 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col1 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row1, col1], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row1;\n\t\t\t\t\t\t\tfrom[1] = col1;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobstructed1 = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\trow2 >= 0 &&\n\t\t\t\t\trow2 < 8 &&\n\t\t\t\t\tcol2 >= 0 &&\n\t\t\t\t\tcol2 < 8 &&\n\t\t\t\t\t!obstructed2 &&\n\t\t\t\t\tthis.board.tiles[row2][col2].piece !== null\n\t\t\t\t) {\n\t\t\t\t\tconst { piece } = this.board.tiles[row2][col2];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row2 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col2 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row2, col2], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row2;\n\t\t\t\t\t\t\tfrom[1] = col2;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobstructed2 = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn { from, to };\n\t}\n\n\t/**\n\t * Search algorithm to find a matching knight.\n\t * @param {number} tarRow Target row for piece move.\n\t * @param {number} tarCol Target column for piece move.\n\t * @param {number} mustBeInRow Moving piece must be in this row. '-1' if unknown.\n\t * @param {number} mustBeInCol Moving piece must be in this column. '-1' if unknown.\n\t * @param {string} token Moving piece must be of this type, e.g 'R'.\n\t * @returns {Object}\n\t */\n\tfindKnight(tarRow, tarCol, mustBeInRow, mustBeInCol, token) {\n\t\tconst color = this.activePlayer % 2 ? 'black' : 'white';\n\t\tconst from = [];\n\t\tconst to = [];\n\t\tfrom[0] = -1;\n\t\tfrom[1] = -1;\n\t\tto[0] = tarRow;\n\t\tto[1] = tarCol;\n\n\t\tfor (let i = -2; i <= 2; i += 4) {\n\t\t\tfor (let j = -1; j <= 1; j += 2) {\n\t\t\t\tconst row1 = to[0] + i;\n\t\t\t\tconst col1 = to[1] + j;\n\t\t\t\tconst row2 = to[0] + j;\n\t\t\t\tconst col2 = to[1] + i;\n\t\t\t\tif (\n\t\t\t\t\trow1 >= 0 &&\n\t\t\t\t\trow1 < 8 &&\n\t\t\t\t\tcol1 >= 0 &&\n\t\t\t\t\tcol1 < 8 &&\n\t\t\t\t\tthis.board.tiles[row1][col1].piece !== null\n\t\t\t\t) {\n\t\t\t\t\tconst { piece } = this.board.tiles[row1][col1];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row1 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col1 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row1, col1], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row1;\n\t\t\t\t\t\t\tfrom[1] = col1;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\trow2 >= 0 &&\n\t\t\t\t\trow2 < 8 &&\n\t\t\t\t\tcol2 >= 0 &&\n\t\t\t\t\tcol2 < 8 &&\n\t\t\t\t\tthis.board.tiles[row2][col2].piece !== null\n\t\t\t\t) {\n\t\t\t\t\tconst { piece } = this.board.tiles[row2][col2];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row2 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col2 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row2, col2], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row2;\n\t\t\t\t\t\t\tfrom[1] = col2;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn { from, to };\n\t}\n\n\t/**\n\t * Checks if the input move would be resulting with the king being in check.\n\t * @param {Number[]} from Coordinates of the source tile of the move that shall be checked.\n\t *  @param {Number[]} to Coordinates of the target tile of the move that shall be checked.\n\t * @returns {boolean} After the move, the king will be in check true/false.\n\t */\n\tcheckCheck(from, to) {\n\t\tconst color = this.activePlayer % 2 ? 'black' : 'white';\n\t\tconst opColor = this.activePlayer % 2 ? 'white' : 'black';\n\t\tconst king = this.board.pieces[color === 'white' ? 28 : 4].pos;\n\t\tlet isInCheck = false;\n\n\t\t// if king move, no check is possible, exit function\n\t\tif (king[0] === from[0] && king[1] === from[1]) return false;\n\n\t\t// check if moving piece is on same line/diag as king, else exit\n\t\tconst diff = [];\n\t\tdiff[0] = from[0] - king[0];\n\t\tdiff[1] = from[1] - king[1];\n\t\tconst checkFor = [];\n\t\tif (diff[0] === 0 || diff[1] === 0) {\n\t\t\tcheckFor[0] = 'Q';\n\t\t\tcheckFor[1] = 'R';\n\t\t} else if (Math.abs(diff[0]) === Math.abs(diff[1])) {\n\t\t\tcheckFor[0] = 'Q';\n\t\t\tcheckFor[1] = 'B';\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\tif (diff[0] !== 0) diff[0] /= Math.abs(diff[0]);\n\t\tif (diff[1] !== 0) diff[1] /= Math.abs(diff[1]);\n\n\t\tconst srcTilePiece = this.board.tiles[from[0]][from[1]].piece;\n\t\tconst tarTilePiece = this.board.tiles[to[0]][to[1]].piece;\n\n\t\t// premove and check if check\n\t\tthis.board.tiles[from[0]][from[1]].piece = null;\n\t\tthis.board.tiles[to[0]][to[1]].piece = srcTilePiece;\n\n\t\t// check for check\n\t\tlet obstructed = false;\n\t\tfor (let j = 1; j < 8 && !isInCheck && !obstructed; j += 1) {\n\t\t\tconst row = king[0] + j * diff[0];\n\t\t\tconst col = king[1] + j * diff[1];\n\n\t\t\tif (\n\t\t\t\trow >= 0 &&\n\t\t\t\trow < 8 &&\n\t\t\t\tcol >= 0 &&\n\t\t\t\tcol < 8 &&\n\t\t\t\tthis.board.tiles[row][col].piece !== null\n\t\t\t) {\n\t\t\t\tconst { piece } = this.board.tiles[row][col];\n\t\t\t\tif (\n\t\t\t\t\t(piece.name.includes(checkFor[0]) ||\n\t\t\t\t\t\tpiece.name.includes(checkFor[1])) &&\n\t\t\t\t\tpiece.color === opColor\n\t\t\t\t) {\n\t\t\t\t\tisInCheck = true;\n\t\t\t\t} else {\n\t\t\t\t\tobstructed = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.board.tiles[from[0]][from[1]].piece = srcTilePiece;\n\t\tthis.board.tiles[to[0]][to[1]].piece = tarTilePiece;\n\n\t\treturn isInCheck;\n\t}\n\n\t/**\n\t * Returns the board coordinates for castling.\n\t * @param {string} move The move to be parsed, e.g. 'O-O'.\n\t * @returns {MoveData.moves}\n\t */\n\tcastle(move) {\n\t\tconst row = this.activePlayer % 2 ? 0 : 7;\n\t\tconst from1 = [];\n\t\tconst from2 = [];\n\t\tconst to1 = [];\n\t\tconst to2 = [];\n\t\tconst moveData = {\n\t\t\tmoves: [],\n\t\t\ttakes: false,\n\t\t\tpromotes: null\n\t\t};\n\n\t\t// O-O\n\t\tif (move.length === 3) {\n\t\t\tfrom1[0] = row;\n\t\t\tfrom1[1] = 4;\n\t\t\tto1[0] = row;\n\t\t\tto1[1] = 6;\n\t\t\tfrom2[0] = row;\n\t\t\tfrom2[1] = 7;\n\t\t\tto2[0] = row;\n\t\t\tto2[1] = 5;\n\n\t\t\t// O-O-O\n\t\t} else {\n\t\t\tfrom1[0] = row;\n\t\t\tfrom1[1] = 4;\n\t\t\tto1[0] = row;\n\t\t\tto1[1] = 2;\n\t\t\tfrom2[0] = row;\n\t\t\tfrom2[1] = 0;\n\t\t\tto2[0] = row;\n\t\t\tto2[1] = 3;\n\t\t}\n\t\tmoveData.moves.push({ from: from1, to: to1 });\n\t\tmoveData.moves.push({ from: from2, to: to2 });\n\t\treturn moveData;\n\t}\n\n\tstatic algebraicToCoords(square) {\n\t\tconst coords = [];\n\t\tconst temp = square.split('');\n\t\tcoords.push(8 - temp[1]);\n\t\tcoords.push(files.indexOf(temp[0]));\n\n\t\treturn coords;\n\t}\n\n\tstatic coordsToAlgebraic(coords) {\n\t\tlet name = files[coords[1]];\n\t\tname += 8 - coords[0];\n\n\t\treturn name;\n\t}\n\n\t/**\n\t * Removes special characters like '#', '+', '?' and '!'\n\t * @param {string} move The move to be cleaned up\n\t * @returns {string} The input string with removed special characters\n\t */\n\tstatic preProcess(move) {\n\t\treturn move.replace(/#|\\+|\\?|!/g, '');\n\t}\n}\n\nexport default GameProcessor;\n","/* eslint-disable */\r\nimport Chessalyzer from './Chessalyzer';\r\n\r\nexport default Chessalyzer;\r\n","module.exports = require(\"events\");","module.exports = require(\"fs\");","module.exports = require(\"line-by-line\");","module.exports = require(\"perf_hooks\");"],"sourceRoot":""}