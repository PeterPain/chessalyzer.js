{"version":3,"sources":["webpack://chessalyzer/webpack/universalModuleDefinition","webpack://chessalyzer/webpack/bootstrap","webpack://chessalyzer/./src/core/ChessBoard.js","webpack://chessalyzer/./src/core/Chessalyzer.js","webpack://chessalyzer/./src/core/GameProcessor.js","webpack://chessalyzer/./src/core/Processor.worker.js","webpack://chessalyzer/./src/tracker/BaseTracker.js","webpack://chessalyzer/./src/tracker/GameTracker.js","webpack://chessalyzer/./src/tracker/PieceTracker.js","webpack://chessalyzer/./src/tracker/TileTracker.js","webpack://chessalyzer/external \"cluster\"","webpack://chessalyzer/external \"events\"","webpack://chessalyzer/external \"fs\"","webpack://chessalyzer/external \"line-by-line\"","webpack://chessalyzer/external \"perf_hooks\""],"names":["pawnTemplate","pieceTemplate","ChessPiece","constructor","name","color","ChessBoard","tiles","Array","row","currRow","col","defaultTiles","map","arr","slice","kingPos","w","b","move","moveData","from","to","castles","castle","player","takes","pos","promotesTo","san","substring","scrKingCol","tarKingCol","srcRookCol","tarRookCol","reset","printPosition","rowArray","piece","push","console","log","performance","require","fs","Chessalyzer","startBatch","path","analyzer","cfg","callback","fun","rate","analyzerArray","isArray","gameProcessor","GameProcessor","on","gameCnt","t0","now","header","processPGN","t1","tdiff","Math","round","mps","cntMoves","cntGames","startBatchMultiCore","batchSize","nThreads","processPGNMultiCore","saveData","data","writeFile","JSON","stringify","err","error","loadData","parse","readFileSync","generateHeatmap","square","optData","sqrCoords","sqrAlg","algebraicToCoords","coordsToAlgebraic","startingPiece","getStartingPiece","sqrData","alg","coords","max","min","i","dataRow","j","loopSqrCoords","loopSqrAlg","loopPiece","loopSqrData","generateComparisonHeatmap","data1","data2","map0","map1","a","sqr","Tracker","Game","GameTracker","Piece","PieceTracker","Tile","TileTracker","Base","BaseTracker","LineByLineReader","EventEmitter","files","cluster","MoveData","board","currentMove","activePlayer","gameAnalyzers","moveAnalyzers","checkConfig","config","hasFilter","Object","prototype","hasOwnProperty","call","filter","Infinity","attachAnalyzers","analyzers","forEach","type","Promise","resolve","cntGameAnalyzer","gameAnalyzerStore","moveAnalyzerStore","analyzerNames","readerFinished","customPath","setupMaster","exec","__dirname","checkAllWorkersFinished","keys","workers","length","addTrackerData","gameTracker","moveTracker","nMoves","add","forkWorker","games","fork","send","msg","kill","game","lr","skipEmptyLines","line","pause","startsWith","key","match","value","moves","replace","split","close","end","resume","nEndForks","ceil","refreshRate","cntGameAnalyers","reject","processLine","processGame","emit","parseMove","analyze","rawMove","token","preProcess","toLowerCase","pawnMove","pieceMove","moveSan","direction","offset","includes","parseInt","indexOf","tarRow","tarCol","mustBeInRow","mustBeInCol","findPiece","findLine","findDiag","findKnight","obstructed1","obstructed2","row1","col1","row2","col2","checkCheck","opColor","king","isInCheck","diff","checkFor","abs","srcTilePiece","tarTilePiece","obstructed","temp","process","TrackerList","proc","TrackerListCustom","__non_webpack_require__","profilingActive","time","track","undefined","Error","GameTrackerBase","wins","tracker","Result","PieceTrackerBase","val","pawn","pawn2","piece2","processTakes","takingPiece","takenPiece","TileStats","movedTo","wasOn","killedOn","wasKilledOn","lastMovedOn","TileTrackerBase","cntMovesGame","cntMovesTotal","resetCurrentPiece","hasPiece","currentPiece","processMove","rook","addOccupation","opPlayer","toAdd"],"mappings":"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","file":"worker.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"chessalyzer\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"chessalyzer\"] = factory();\n\telse\n\t\troot[\"chessalyzer\"] = factory();\n})(global, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/core/Processor.worker.js\");\n","const pawnTemplate = ['Pa', 'Pb', 'Pc', 'Pd', 'Pe', 'Pf', 'Pg', 'Ph'];\nconst pieceTemplate = ['Ra', 'Nb', 'Bc', 'Qd', 'Ke', 'Bf', 'Ng', 'Rh'];\n\nclass ChessPiece {\n\tconstructor(name, color) {\n\t\tthis.name = name;\n\t\tthis.color = color;\n\t}\n}\n\nclass ChessBoard {\n\tconstructor() {\n\t\tthis.tiles = new Array(8);\n\t\tfor (let row = 0; row < 8; row += 1) {\n\t\t\tconst currRow = new Array(8);\n\t\t\tfor (let col = 0; col < 8; col += 1) {\n\t\t\t\tcurrRow[col] = null;\n\t\t\t\tconst color = row === 0 || row === 1 ? 'b' : 'w';\n\n\t\t\t\t// init pieces\n\t\t\t\tif (row === 0 || row === 7) {\n\t\t\t\t\tcurrRow[col] = new ChessPiece(pieceTemplate[col], color);\n\t\t\t\t} else if (row === 1 || row === 6) {\n\t\t\t\t\tcurrRow[col] = new ChessPiece(pawnTemplate[col], color);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.tiles[row] = currRow;\n\t\t}\n\t\tthis.defaultTiles = this.tiles.map(arr => arr.slice());\n\t\tthis.kingPos = { w: [7, 4], b: [0, 4] };\n\t}\n\n\tmove(moveData) {\n\t\tconst { from } = moveData;\n\t\tconst { to } = moveData;\n\n\t\t// castles\n\t\tif (moveData.castles !== '') {\n\t\t\tthis.castle(moveData.castles, moveData.player);\n\n\t\t\t// moves/takes\n\t\t} else if (from[0] !== -1) {\n\t\t\t// takes\n\t\t\tif ('pos' in moveData.takes) {\n\t\t\t\tthis.tiles[moveData.takes.pos[0]][moveData.takes.pos[1]] = null;\n\t\t\t}\n\t\t\t// moves\n\t\t\tthis.tiles[to[0]][to[1]] = this.tiles[from[0]][from[1]];\n\t\t\tthis.tiles[from[0]][from[1]] = null;\n\n\t\t\tif (moveData.promotesTo !== '') {\n\t\t\t\tthis.tiles[to[0]][to[1]] = new ChessPiece(\n\t\t\t\t\tmoveData.promotesTo,\n\t\t\t\t\tmoveData.player\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (moveData.san.substring(0, 1) === 'K') {\n\t\t\t\tthis.kingPos[moveData.player] = to;\n\t\t\t}\n\t\t}\n\t}\n\n\tcastle(move, player) {\n\t\tconst row = player === 'w' ? 7 : 0;\n\t\tconst scrKingCol = 4;\n\t\tlet tarKingCol = 6;\n\t\tlet srcRookCol = 7;\n\t\tlet tarRookCol = 5;\n\n\t\tif (move === 'O-O-O') {\n\t\t\ttarKingCol = 2;\n\t\t\ttarRookCol = 3;\n\t\t\tsrcRookCol = 0;\n\t\t}\n\t\tthis.tiles[row][tarKingCol] = this.tiles[row][scrKingCol];\n\t\tthis.tiles[row][tarRookCol] = this.tiles[row][srcRookCol];\n\t\tthis.tiles[row][scrKingCol] = null;\n\t\tthis.tiles[row][srcRookCol] = null;\n\t\tthis.kingPos[player] = [row, tarKingCol];\n\t}\n\n\treset() {\n\t\tthis.tiles = this.defaultTiles.map(arr => arr.slice());\n\t\tthis.kingPos = { w: [7, 4], b: [0, 4] };\n\t}\n\n\t/** Prints the current board position to the console. */\n\tprintPosition() {\n\t\tfor (let row = 0; row < 8; row += 1) {\n\t\t\tconst rowArray = [];\n\t\t\tfor (let col = 0; col < 8; col += 1) {\n\t\t\t\tconst piece = this.tiles[row][col];\n\t\t\t\tif (piece !== null) {\n\t\t\t\t\trowArray.push(piece.color + piece.name);\n\t\t\t\t} else {\n\t\t\t\t\trowArray.push('...');\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(rowArray);\n\t\t}\n\t}\n}\n\nexport default ChessBoard;\n","import GameProcessor from './GameProcessor';\n\nimport PieceTracker from '../tracker/PieceTracker';\nimport TileTracker from '../tracker/TileTracker';\nimport GameTracker from '../tracker/GameTracker';\nimport BaseTracker from '../tracker/BaseTracker';\n\nconst { performance } = require('perf_hooks');\n\nconst fs = require('fs');\n\nconst pawnTemplate = ['Pa', 'Pb', 'Pc', 'Pd', 'Pe', 'Pf', 'Pg', 'Ph'];\nconst pieceTemplate = ['Ra', 'Nb', 'Bc', 'Qd', 'Ke', 'Bf', 'Ng', 'Rh'];\n\n/** Main class for batch processing and generating heat maps */\nclass Chessalyzer {\n\t/**\n\t * Starts the singlethreaded batch processing for the selected file\n\t * @param {String} path - Path to the PGN file that should be analyzed\n\t * @param {(Object|Object[])} analyzer - The analysis functions that shall be run\n\t *  during batch processing. Can be one single analyzer or an array of analyzers.\n\t * @param {Object} [cfg = {}]\n\t * @param {Function} [cfg.filter = ()=>true] - Filter function for selecting games\n\t * @param {Number} [cfg.cntGames = Infinite ] - Max amount of games to process\n\t * @param {Object} callback - Callback object\n\t * @param {Function} [callback.fun] - Callback function that is called every callback.rate games\n\t * @param {Number} [callback.rate] - Every 'rate' games the callback function is called.\n\t * @returns {Promise}\n\t */\n\tstatic async startBatch(\n\t\tpath,\n\t\tanalyzer,\n\t\tcfg = {},\n\t\tcallback = { fun: () => {}, rate: 250 }\n\t) {\n\t\t// check if single analyzer or array is passed\n\t\tlet analyzerArray = analyzer;\n\t\tif (!Array.isArray(analyzerArray)) {\n\t\t\tanalyzerArray = [analyzer];\n\t\t}\n\n\t\tconst gameProcessor = new GameProcessor();\n\n\t\t// callback handler\n\t\tgameProcessor.on('status', gameCnt => {\n\t\t\tcallback.fun(gameCnt);\n\t\t});\n\n\t\tconst t0 = performance.now();\n\n\t\tconst header = await gameProcessor.processPGN(\n\t\t\tpath,\n\t\t\tcfg,\n\t\t\tanalyzerArray,\n\t\t\tcallback.rate\n\t\t);\n\n\t\tconst t1 = performance.now();\n\t\tconst tdiff = Math.round(t1 - t0) / 1000;\n\t\tconst mps = Math.round(header.cntMoves / tdiff);\n\n\t\tconsole.log(\n\t\t\t`${header.cntGames} games (${\n\t\t\t\theader.cntMoves\n\t\t\t} moves) processed in ${tdiff}s (${mps} moves/s)`\n\t\t);\n\t\treturn header;\n\t}\n\n\t/**\n\t * Starts the multithreaded batch processing for the selected file\n\t * @param {String} path - Path to the PGN file that should be analyzed\n\t * @param {(Object|Object[])} analyzer - The analysis functions that shall be run\n\t *  during batch processing. Can be one single analyzer or an array of analyzers.\n\t * @param {Numer} [nCores = -1] Numbers of threads to use. Is limited to the max. amount\n\t *  of threads of the running machine.\n\t * @param {Function} [cfg.filter = ()=>true] - Filter function for selecting games\n\t * @param {Number} [cfg.cntGames = Infinite ] - Max amount of games to process\n\t * @returns {Promise}\n\t */\n\tstatic async startBatchMultiCore(\n\t\tpath,\n\t\tanalyzer,\n\t\tcfg = {},\n\t\tbatchSize = 8000,\n\t\tnThreads = 1\n\t) {\n\t\t// check if single analyzer or array is passed\n\t\tlet analyzerArray = analyzer;\n\t\tif (!Array.isArray(analyzerArray)) {\n\t\t\tanalyzerArray = [analyzer];\n\t\t}\n\t\tconst t0 = performance.now();\n\n\t\tconst header = await GameProcessor.processPGNMultiCore(\n\t\t\tpath,\n\t\t\tcfg,\n\t\t\tanalyzerArray,\n\t\t\tbatchSize,\n\t\t\tnThreads\n\t\t);\n\n\t\tconst t1 = performance.now();\n\t\tconst tdiff = Math.round(t1 - t0) / 1000;\n\t\tconst mps = Math.round(header.cntMoves / tdiff);\n\n\t\tconsole.log(\n\t\t\t`${header.cntGames} games (${\n\t\t\t\theader.cntMoves\n\t\t\t} moves) processed in ${tdiff}s (${mps} moves/s)`\n\t\t);\n\t\theader.mps = mps;\n\t\treturn header;\n\t}\n\n\t/**\n\t * Saves a completed batch run to a JSON file\n\t * @param {String} path - Path the data file shall be saved to\n\t * @param {Object} data - The data that shall be saved\n\t */\n\tstatic saveData(path, data) {\n\t\tfs.writeFile(path, JSON.stringify(data), err => {\n\t\t\tif (err) {\n\t\t\t\tconsole.error(err);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconsole.log('File has been created.');\n\t\t});\n\t}\n\n\t/**\n\t * Loads the stats of a previous batch run (JSON) to a data bank\n\t * @param {String} path - Path the data file shall be loaded from\n\t * @returns {Object} Returns the loaded data\n\t */\n\tstatic loadData(path) {\n\t\tconst data = JSON.parse(fs.readFileSync(path, 'utf8'));\n\t\tconsole.log(`File '${path}' has been loaded.`);\n\t\treturn data;\n\t}\n\n\t/**\n\t * Generates a heatmap out of the tracked data.\n\t * @param {Object} data - Where the data shall be taken from\n\t * @param {(String|Array)} square - The square the data shall be generated for.\n\t * For example, if you wanted to know how often a specific piece was on a specific tile,\n\t * you would pass the identifier of the tile to the function, e.g. \"a2\" or [7,1].\n\t * @param {Function} fun - The evaluation function that generates the heatmap out of the\n\t * data.\n\t * See ./src/exampleHeatmapConfig for examples of such a function.\n\t * @param {} optData - Optional data you may need in your eval function\n\t * @returns {Array} Array with 3 entries:\n\t * <ol>\n\t * <li>8x8 Array containing the heat map values for each tile</li>\n\t * <li>The minimum value in the heatmap.</li>\n\t * <li>The maximum value in the heatmap.</li>\n\t * </ol>\n\t */\n\tstatic generateHeatmap(data, square, fun, optData) {\n\t\tlet sqrCoords;\n\t\tlet sqrAlg;\n\n\t\t// square input type 'a2'\n\t\tif (typeof square === 'string') {\n\t\t\tsqrCoords = GameProcessor.algebraicToCoords(square);\n\t\t\tsqrAlg = square;\n\n\t\t\t// input type [6,0]\n\t\t} else {\n\t\t\tsqrCoords = square;\n\t\t\tsqrAlg = GameProcessor.coordsToAlgebraic(square);\n\t\t}\n\n\t\tconst startingPiece = Chessalyzer.getStartingPiece(sqrCoords);\n\t\tconst sqrData = {\n\t\t\talg: sqrAlg,\n\t\t\tcoords: sqrCoords,\n\t\t\tpiece: startingPiece\n\t\t};\n\t\tconst map = [];\n\t\tlet max = 0;\n\t\tlet min = 1000000;\n\n\t\tfor (let i = 0; i < 8; i += 1) {\n\t\t\tconst dataRow = new Array(8);\n\t\t\tfor (let j = 0; j < 8; j += 1) {\n\t\t\t\tconst loopSqrCoords = [i, j];\n\t\t\t\tconst loopSqrAlg = GameProcessor.coordsToAlgebraic(\n\t\t\t\t\tloopSqrCoords\n\t\t\t\t);\n\t\t\t\tconst loopPiece = Chessalyzer.getStartingPiece(loopSqrCoords);\n\t\t\t\tconst loopSqrData = {\n\t\t\t\t\talg: loopSqrAlg,\n\t\t\t\t\tcoords: loopSqrCoords,\n\t\t\t\t\tpiece: loopPiece\n\t\t\t\t};\n\n\t\t\t\tdataRow[j] = fun(data, sqrData, loopSqrData, optData);\n\t\t\t\tif (dataRow[j] > max) max = dataRow[j];\n\t\t\t\tif (dataRow[j] < min) min = dataRow[j];\n\t\t\t}\n\t\t\tmap.push(dataRow);\n\t\t}\n\n\t\treturn [map, min, max];\n\t}\n\n\t/**\n\t * Generates a comparison heatmap out of the tracked data. There needs to data in both\n\t * banks you pass as bank1 and bank2 params. The heatmap for both banks is calculated\n\t * and then the relative differences between both banks are calculated. For example,\n\t * if the heatmap value for \"a1\" of bank1 is 10 and the value of bank2 is 5, the returned\n\t * value for \"a1\" would be 100% ([[10/5] -1] *100).\n\t * @param {Object} data1 - Dataset 1\n\t * @param {Object} data2 - Dataset 2\n\t * @param {(String|Array)} square - The square the data shall be generated for. Notation\n\t * can be 'a1' or [7,0].\n\t * @param {Function} fun - The evaluation function that generates the heatmap out of the\n\t * saved data. See {@link generateHeatmap} for a more detailed description.\n\t * @param {} optData - Optional data you may need in your eval function\n\t * @returns {Array} Array with 3 entries:\n\t * <ol>\n\t * <li>8x8 Array containing the heat map values for each tile</li>\n\t * <li>The minimum value in the heatmap.</li>\n\t * <li>The maximum value in the heatmap.</li>\n\t * </ol>\n\t */\n\tstatic generateComparisonHeatmap(data1, data2, square, fun, optData) {\n\t\tconst map = [];\n\t\tlet max = 0;\n\t\tlet min = 100000;\n\n\t\t// comparison heatmap\n\t\tconst map0 = Chessalyzer.generateHeatmap(data1, square, fun, optData);\n\t\tconst map1 = Chessalyzer.generateHeatmap(data2, square, fun, optData);\n\n\t\tfor (let i = 0; i < 8; i += 1) {\n\t\t\tconst dataRow = new Array(8);\n\t\t\tfor (let j = 0; j < 8; j += 1) {\n\t\t\t\tconst a = map0[0][i][j];\n\t\t\t\tconst b = map1[0][i][j];\n\t\t\t\tif (a === 0 || b === 0) dataRow[j] = 0;\n\t\t\t\telse dataRow[j] = (a >= b ? a / b - 1 : -b / a + 1) * 100;\n\n\t\t\t\tif (dataRow[j] > max) max = dataRow[j];\n\t\t\t\tif (dataRow[j] < min) min = dataRow[j];\n\t\t\t}\n\t\t\tmap.push(dataRow);\n\t\t}\n\n\t\treturn [map, min, max];\n\t}\n\n\tstatic getStartingPiece(sqr) {\n\t\tlet color = '';\n\t\tlet name = '';\n\t\tif (sqr[0] === 0) {\n\t\t\tcolor = 'b';\n\t\t\tname = pieceTemplate[sqr[1]];\n\t\t} else if (sqr[0] === 1) {\n\t\t\tcolor = 'b';\n\t\t\tname = pawnTemplate[sqr[1]];\n\t\t} else if (sqr[0] === 6) {\n\t\t\tcolor = 'w';\n\t\t\tname = pawnTemplate[sqr[1]];\n\t\t} else if (sqr[0] === 7) {\n\t\t\tcolor = 'w';\n\t\t\tname = pieceTemplate[sqr[1]];\n\t\t}\n\n\t\treturn { color, name };\n\t}\n}\n\nChessalyzer.Tracker = {\n\tGame: GameTracker,\n\tPiece: PieceTracker,\n\tTile: TileTracker,\n\tBase: BaseTracker\n};\n\nexport default Chessalyzer;\n","/* eslint-disable no-inner-declarations */\nimport ChessBoard from './ChessBoard';\n\nconst LineByLineReader = require('line-by-line');\nconst EventEmitter = require('events');\n\nconst files = 'abcdefgh';\n\nconst cluster = require('cluster');\n\nclass MoveData {\n\tconstructor() {\n\t\tthis.san = '';\n\t\tthis.player = '';\n\t\tthis.piece = '';\n\t\tthis.castles = '';\n\t\tthis.takes = {};\n\t\tthis.promotesTo = '';\n\t\tthis.from = [-1, -1];\n\t\tthis.to = [-1, -1];\n\t}\n}\n\n/**\n * Class that processes games.\n */\nclass GameProcessor extends EventEmitter {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.board = new ChessBoard();\n\t\tthis.currentMove = new MoveData();\n\t\tthis.activePlayer = 0;\n\t\tthis.cntMoves = 0;\n\t\tthis.cntGames = 0;\n\t\tthis.gameAnalyzers = [];\n\t\tthis.moveAnalyzers = [];\n\t}\n\n\tstatic checkConfig(config) {\n\t\tconst cfg = {};\n\t\tcfg.hasFilter = Object.prototype.hasOwnProperty.call(config, 'filter');\n\t\tcfg.filter = cfg.hasFilter ? config.filter : () => true;\n\n\t\tcfg.cntGames = Object.prototype.hasOwnProperty.call(config, 'cntGames')\n\t\t\t? config.cntGames\n\t\t\t: Infinity;\n\n\t\treturn cfg;\n\t}\n\n\tattachAnalyzers(analyzers) {\n\t\tanalyzers.forEach(a => {\n\t\t\tif (a.type === 'move') {\n\t\t\t\tthis.moveAnalyzers.push(a);\n\t\t\t} else if (a.type === 'game') {\n\t\t\t\tthis.gameAnalyzers.push(a);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic processPGNMultiCore(path, config, analyzer, batchSize, nThreads) {\n\t\treturn new Promise(resolve => {\n\t\t\tlet cntGameAnalyzer = 0;\n\t\t\tconst gameAnalyzerStore = [];\n\t\t\tconst moveAnalyzerStore = [];\n\t\t\tconst analyzerNames = [];\n\t\t\tlet cntGames = 0;\n\t\t\tlet cntMoves = 0;\n\t\t\tlet readerFinished = false;\n\t\t\tlet customPath = '';\n\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tcluster.setupMaster({\n\t\t\t\texec: `${__dirname}/worker.js`\n\t\t\t});\n\n\t\t\tanalyzer.forEach(a => {\n\t\t\t\tif (a.type === 'game') {\n\t\t\t\t\tcntGameAnalyzer += 1;\n\t\t\t\t\tgameAnalyzerStore.push(a);\n\t\t\t\t} else if (a.type === 'move') {\n\t\t\t\t\tmoveAnalyzerStore.push(a);\n\t\t\t\t}\n\t\t\t\tanalyzerNames.push(a.constructor.name);\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(a, 'path')) {\n\t\t\t\t\tcustomPath = a.path;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfunction checkAllWorkersFinished() {\n\t\t\t\tif (\n\t\t\t\t\tObject.keys(cluster.workers).length === 0 &&\n\t\t\t\t\treaderFinished\n\t\t\t\t) {\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tcntGames,\n\t\t\t\t\t\tcntMoves\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction addTrackerData(gameTracker, moveTracker, nMoves) {\n\t\t\t\tfor (let i = 0; i < gameAnalyzerStore.length; i += 1) {\n\t\t\t\t\tgameAnalyzerStore[i].add(gameTracker[i]);\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < moveAnalyzerStore.length; i += 1) {\n\t\t\t\t\tmoveAnalyzerStore[i].add(moveTracker[i]);\n\t\t\t\t}\n\t\t\t\tcntMoves += nMoves;\n\t\t\t}\n\n\t\t\tfunction forkWorker(games) {\n\t\t\t\tconst w = cluster.fork();\n\t\t\t\tw.send({\n\t\t\t\t\tgames,\n\t\t\t\t\tcustomPath,\n\t\t\t\t\tanalyzerNames\n\t\t\t\t});\n\n\t\t\t\t// on worker finish\n\t\t\t\tw.on('message', msg => {\n\t\t\t\t\taddTrackerData(\n\t\t\t\t\t\tmsg.gameAnalyzers,\n\t\t\t\t\t\tmsg.moveAnalyzers,\n\t\t\t\t\t\tmsg.cntMoves\n\t\t\t\t\t);\n\n\t\t\t\t\tw.kill();\n\n\t\t\t\t\t// if all workers finished, resolve promise\n\t\t\t\t\tcheckAllWorkersFinished();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst cfg = GameProcessor.checkConfig(config);\n\n\t\t\tlet games = [];\n\t\t\tlet game = {};\n\n\t\t\tconst lr = new LineByLineReader(path, {\n\t\t\t\tskipEmptyLines: true\n\t\t\t});\n\n\t\t\tlr.on('error', err => {\n\t\t\t\tconsole.log(err);\n\t\t\t});\n\n\t\t\tlr.on('line', line => {\n\t\t\t\tlr.pause();\n\n\t\t\t\t// data tag\n\t\t\t\tif (\n\t\t\t\t\tline.startsWith('[') &&\n\t\t\t\t\t(cfg.hasFilter || cntGameAnalyzer > 0)\n\t\t\t\t) {\n\t\t\t\t\tconst key = line.match(/\\[(.*?)\\s/)[1];\n\t\t\t\t\tconst value = line.match(/\"(.*?)\"/)[1];\n\n\t\t\t\t\tgame[key] = value;\n\n\t\t\t\t\t// moves\n\t\t\t\t} else if (line.startsWith('1')) {\n\t\t\t\t\tgame.moves = line\n\t\t\t\t\t\t.replace(/\\{(.*?)\\}\\s/g, '')\n\t\t\t\t\t\t.replace(/\\d+\\.+\\s/g, '')\n\t\t\t\t\t\t.replace(' *', '')\n\t\t\t\t\t\t.split(' ');\n\n\t\t\t\t\tif (cfg.filter(game) || !cfg.hasFilter) {\n\t\t\t\t\t\tcntGames += 1;\n\t\t\t\t\t\tgames.push(game);\n\n\t\t\t\t\t\tif (cntGames % (batchSize * nThreads) === 0) {\n\t\t\t\t\t\t\tfor (let i = 0; i < nThreads; i += 1) {\n\t\t\t\t\t\t\t\tforkWorker(\n\t\t\t\t\t\t\t\t\tgames.slice(\n\t\t\t\t\t\t\t\t\t\ti * batchSize,\n\t\t\t\t\t\t\t\t\t\ti * batchSize + batchSize\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tgames = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tgame = {};\n\t\t\t\t}\n\t\t\t\tif (cntGames >= cfg.cntGames) {\n\t\t\t\t\tlr.close();\n\t\t\t\t\tlr.end();\n\t\t\t\t} else {\n\t\t\t\t\tlr.resume();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlr.on('end', () => {\n\t\t\t\tif (games.length > 0) {\n\t\t\t\t\tif (games.length > batchSize) {\n\t\t\t\t\t\tconst nEndForks = Math.ceil(games.length / batchSize);\n\t\t\t\t\t\tfor (let i = 0; i < nEndForks; i += 1) {\n\t\t\t\t\t\t\tforkWorker(\n\t\t\t\t\t\t\t\tgames.slice(\n\t\t\t\t\t\t\t\t\ti * batchSize,\n\t\t\t\t\t\t\t\t\ti * batchSize + batchSize\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tforkWorker(games);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treaderFinished = true;\n\t\t\t\tcheckAllWorkersFinished();\n\t\t\t});\n\t\t});\n\t}\n\n\tprocessPGN(path, config, analyzers, refreshRate) {\n\t\tconst cfg = GameProcessor.checkConfig(config);\n\n\t\tthis.attachAnalyzers(analyzers);\n\n\t\tconst cntGameAnalyers = this.gameAnalyzers.length;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst lr = new LineByLineReader(path, { skipEmptyLines: true });\n\t\t\tlet game = {};\n\n\t\t\t// process current line\n\t\t\tconst processLine = line => {\n\t\t\t\t// data tag\n\t\t\t\tif (\n\t\t\t\t\tline.startsWith('[') &&\n\t\t\t\t\t(cfg.hasFilter || cntGameAnalyers > 0)\n\t\t\t\t) {\n\t\t\t\t\tconst key = line.match(/\\[(.*?)\\s/)[1];\n\t\t\t\t\tconst value = line.match(/\"(.*?)\"/)[1];\n\n\t\t\t\t\tgame[key] = value;\n\n\t\t\t\t\t// moves\n\t\t\t\t} else if (line.startsWith('1')) {\n\t\t\t\t\tgame.moves = line\n\t\t\t\t\t\t.replace(/\\{(.*?)\\}\\s/g, '')\n\t\t\t\t\t\t.replace(/\\d+\\.+\\s/g, '')\n\t\t\t\t\t\t.replace(' *', '')\n\t\t\t\t\t\t.split(' ');\n\n\t\t\t\t\tif (cfg.filter(game) || !cfg.hasFilter) {\n\t\t\t\t\t\tthis.processGame(game);\n\t\t\t\t\t}\n\n\t\t\t\t\t// emit event\n\t\t\t\t\tif (this.cntGames % refreshRate === 0) {\n\t\t\t\t\t\tthis.emit('status', this.cntGames);\n\t\t\t\t\t}\n\n\t\t\t\t\tgame = {};\n\t\t\t\t}\n\t\t\t\tif (this.cntGames >= cfg.cntGames) {\n\t\t\t\t\tlr.close();\n\t\t\t\t\tlr.end();\n\t\t\t\t} else {\n\t\t\t\t\tlr.resume();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tlr.on('error', err => {\n\t\t\t\tconsole.log(err);\n\t\t\t\treject();\n\t\t\t});\n\n\t\t\tlr.on('line', line => {\n\t\t\t\t// pause emitting of lines...\n\t\t\t\tlr.pause();\n\n\t\t\t\tprocessLine(line);\n\t\t\t});\n\n\t\t\tlr.on('end', () => {\n\t\t\t\tconsole.log('Read entire file.');\n\t\t\t\tresolve({ cntGames: this.cntGames, cntMoves: this.cntMoves });\n\t\t\t});\n\t\t});\n\t}\n\n\tprocessGame(game) {\n\t\tconst { moves } = game;\n\n\t\tfor (let i = 0; i < moves.length; i += 1) {\n\t\t\tthis.activePlayer = i % 2;\n\n\t\t\t// fetch move data into this.currentMove\n\t\t\tthis.parseMove(moves[i]);\n\n\t\t\t// move based analyzers\n\t\t\tthis.moveAnalyzers.forEach(a => {\n\t\t\t\ta.analyze(this.currentMove);\n\t\t\t});\n\n\t\t\tthis.board.move(this.currentMove);\n\t\t}\n\t\tthis.cntMoves += moves.length - 1; // don't count result (e.g. 1-0)\n\t\tthis.cntGames += 1;\n\t\tthis.board.reset();\n\n\t\t// game based analyzers\n\t\tthis.gameAnalyzers.forEach(a => {\n\t\t\ta.analyze(game);\n\t\t});\n\t}\n\n\treset() {\n\t\tthis.board.reset();\n\t\tthis.activePlayer = 0;\n\t}\n\n\t/**\n\t * Parses a move in string format to board coordinates. Wrapper function for\n\t * the different move algorithms.\n\t * @param {string} rawMove The move to be parsed, e.g. 'Ne5+'.\n\t */\n\tparseMove(rawMove) {\n\t\tconst token = rawMove.substring(0, 1);\n\t\tconst move = GameProcessor.preProcess(rawMove);\n\n\t\tthis.currentMove = new MoveData();\n\t\tthis.currentMove.san = rawMove;\n\t\tthis.currentMove.player = this.activePlayer === 0 ? 'w' : 'b';\n\n\t\t// game end on '1-0', '0-1' or '1/2-1/2' (check for digit as first char)\n\t\tif (token.match(/\\d/) === null) {\n\t\t\tif (token.toLowerCase() === token) {\n\t\t\t\tthis.pawnMove(move);\n\t\t\t} else if (token !== 'O') {\n\t\t\t\tthis.pieceMove(move);\n\t\t\t} else {\n\t\t\t\tthis.currentMove.castles = move;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns the board coordinates for the move if it is a pawn move.\n\t * @param {string} moveSan The move to be parsed, e.g. 'e5'.\n\t */\n\tpawnMove(moveSan) {\n\t\tconst direction = -2 * (this.activePlayer % 2) + 1;\n\t\tconst from = [];\n\t\tconst to = [];\n\t\tlet move = moveSan;\n\t\tlet offset = 0;\n\n\t\t// takes\n\t\tif (move.includes('x')) {\n\t\t\tmove = move.replace('x', '');\n\n\t\t\tto[0] = 8 - parseInt(move.substring(2, 3), 10);\n\t\t\tto[1] = files.indexOf(move.substring(1, 2));\n\t\t\tfrom[0] = to[0] + direction;\n\t\t\tfrom[1] = files.indexOf(move.substring(0, 1));\n\n\t\t\t// en passant\n\t\t\tif (this.board.tiles[to[0]][to[1]] === null) {\n\t\t\t\toffset = this.currentMove.player === 'w' ? 1 : -1;\n\t\t\t}\n\n\t\t\tthis.currentMove.takes.piece = this.board.tiles[to[0] + offset][\n\t\t\t\tto[1]\n\t\t\t].name;\n\t\t\tthis.currentMove.takes.pos = [to[0] + offset, to[1]];\n\n\t\t\t// moves\n\t\t} else {\n\t\t\tconst tarRow = 8 - parseInt(move.substring(1, 2), 10);\n\t\t\tconst tarCol = files.indexOf(move.substring(0, 1));\n\n\t\t\tfrom[1] = tarCol;\n\t\t\tto[0] = tarRow;\n\t\t\tto[1] = tarCol;\n\t\t\tfor (let i = tarRow + direction; i < 8 && i >= 0; i += direction) {\n\t\t\t\tif (this.board.tiles[i][tarCol] !== null) {\n\t\t\t\t\tif (this.board.tiles[i][tarCol].name.includes('P')) {\n\t\t\t\t\t\tfrom[0] = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.currentMove.to = to;\n\t\tthis.currentMove.from = from;\n\t\tthis.currentMove.piece = this.board.tiles[from[0]][from[1]].name;\n\n\t\t// promotes\n\t\tif (move.includes('=')) {\n\t\t\tthis.currentMove.promotesTo = move.substring(\n\t\t\t\tmove.length - 1,\n\t\t\t\tmove.length\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Returns the board coordinates for a piece (!= pawn) move.\n\t * @param {string} moveSan The move to be parsed, e.g. 'Be3'.\n\t */\n\tpieceMove(moveSan) {\n\t\tlet move = moveSan;\n\t\tlet takes = false;\n\t\tlet coords = { from: [], to: [] };\n\t\tconst token = move.substring(0, 1);\n\n\t\t// remove token\n\t\tmove = move.substring(1, move.length);\n\n\t\t// takes\n\t\tif (move.includes('x')) {\n\t\t\ttakes = true;\n\t\t\tmove = move.replace('x', '');\n\t\t}\n\n\t\t// e.g. Re3f5\n\t\tif (move.length === 4) {\n\t\t\tcoords.from[0] = 8 - parseInt(move.substring(1, 2), 10);\n\t\t\tcoords.from[1] = files.indexOf(move.substring(0, 1));\n\t\t\tcoords.to[0] = 8 - parseInt(move.substring(3, 4), 10);\n\t\t\tcoords.to[1] = files.indexOf(move.substring(2, 3));\n\n\t\t\t// e.g. Ref3\n\t\t} else if (move.length === 3) {\n\t\t\tconst tarRow = 8 - parseInt(move.substring(2, 3), 10);\n\t\t\tconst tarCol = files.indexOf(move.substring(1, 2));\n\t\t\tlet mustBeInRow = -1;\n\t\t\tlet mustBeInCol = -1;\n\n\t\t\t// file is specified\n\t\t\tif (files.indexOf(move.substring(0, 1)) >= 0) {\n\t\t\t\tmustBeInCol = files.indexOf(move.substring(0, 1));\n\n\t\t\t\t// rank is specified\n\t\t\t} else {\n\t\t\t\tmustBeInRow = 8 - parseInt(move.substring(0, 1), 10);\n\t\t\t}\n\t\t\tcoords = this.findPiece(\n\t\t\t\ttarRow,\n\t\t\t\ttarCol,\n\t\t\t\tmustBeInRow,\n\t\t\t\tmustBeInCol,\n\t\t\t\ttoken\n\t\t\t);\n\n\t\t\t// e.g. Rf3\n\t\t} else {\n\t\t\tconst tarRow = 8 - parseInt(move.substring(1, 2), 10);\n\t\t\tconst tarCol = files.indexOf(move.substring(0, 1));\n\t\t\tcoords = this.findPiece(tarRow, tarCol, -1, -1, token);\n\t\t}\n\n\t\t// set move data\n\t\tthis.currentMove.from = coords.from;\n\t\tthis.currentMove.to = coords.to;\n\t\tthis.currentMove.piece = this.board.tiles[coords.from[0]][\n\t\t\tcoords.from[1]\n\t\t].name;\n\n\t\tif (takes) {\n\t\t\tthis.currentMove.takes.piece = this.board.tiles[\n\t\t\t\tthis.currentMove.to[0]\n\t\t\t][this.currentMove.to[1]].name;\n\t\t\tthis.currentMove.takes.pos = this.currentMove.to;\n\t\t}\n\t}\n\n\t/**\n\t * Wrapper function for different piece search algorithms.\n\t * @param {number} tarRow Target row for piece move.\n\t * @param {number} tarCol Target column for piece move.\n\t * @param {number} mustBeInRow Moving piece must be in this row. '-1' if unknown.\n\t * @param {number} mustBeInCol Moving piece must be in this column. '-1' if unknown.\n\t * @param {string} token Moving piece must be of this type, e.g 'R'.\n\t * @returns {Object}\n\t */\n\tfindPiece(tarRow, tarCol, mustBeInRow, mustBeInCol, token) {\n\t\tlet move;\n\n\t\tif (token === 'R') {\n\t\t\tmove = this.findLine(\n\t\t\t\ttarRow,\n\t\t\t\ttarCol,\n\t\t\t\tmustBeInRow,\n\t\t\t\tmustBeInCol,\n\t\t\t\ttoken\n\t\t\t);\n\t\t} else if (token === 'B') {\n\t\t\tmove = this.findDiag(\n\t\t\t\ttarRow,\n\t\t\t\ttarCol,\n\t\t\t\tmustBeInRow,\n\t\t\t\tmustBeInCol,\n\t\t\t\ttoken\n\t\t\t);\n\t\t} else if (token === 'Q' || token === 'K') {\n\t\t\tmove = this.findDiag(\n\t\t\t\ttarRow,\n\t\t\t\ttarCol,\n\t\t\t\tmustBeInRow,\n\t\t\t\tmustBeInCol,\n\t\t\t\ttoken\n\t\t\t);\n\t\t\tif (move.from[0] === -1) {\n\t\t\t\tmove = this.findLine(\n\t\t\t\t\ttarRow,\n\t\t\t\t\ttarCol,\n\t\t\t\t\tmustBeInRow,\n\t\t\t\t\tmustBeInCol,\n\t\t\t\t\ttoken\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (token === 'N') {\n\t\t\tmove = this.findKnight(\n\t\t\t\ttarRow,\n\t\t\t\ttarCol,\n\t\t\t\tmustBeInRow,\n\t\t\t\tmustBeInCol,\n\t\t\t\ttoken\n\t\t\t);\n\t\t}\n\t\tif (move.from[0] === -1) {\n\t\t\tconsole.log(\n\t\t\t\t`Error: no piece for move ${token} to (${tarRow},${tarCol}) found!`\n\t\t\t);\n\t\t\tconsole.log(this.cntGames);\n\t\t\tconsole.log(this.currentMove);\n\t\t\tthis.board.printPosition();\n\t\t}\n\n\t\treturn move;\n\t}\n\n\t/**\n\t * Search algorithm to find a piece that can move diagonally.\n\t * @param {number} tarRow Target row for piece move.\n\t * @param {number} tarCol Target column for piece move.\n\t * @param {number} mustBeInRow Moving piece must be in this row. '-1' if unknown.\n\t * @param {number} mustBeInCol Moving piece must be in this column. '-1' if unknown.\n\t * @param {string} token Moving piece must be of this type, e.g 'R'.\n\t * @returns {Object}\n\t */\n\tfindDiag(tarRow, tarCol, mustBeInRow, mustBeInCol, token) {\n\t\tconst color = this.currentMove.player;\n\n\t\tconst from = [];\n\t\tconst to = [];\n\t\tfrom[0] = -1;\n\t\tfrom[1] = -1;\n\t\tto[0] = tarRow;\n\t\tto[1] = tarCol;\n\n\t\tfor (let i = -1; i <= 1; i += 2) {\n\t\t\tlet obstructed1 = false;\n\t\t\tlet obstructed2 = false;\n\t\t\tfor (let j = 1; j < 8; j += 1) {\n\t\t\t\tconst row1 = to[0] + i * j;\n\t\t\t\tconst col1 = to[1] + j;\n\t\t\t\tconst row2 = to[0] - i * j;\n\t\t\t\tconst col2 = to[1] - j;\n\n\t\t\t\tif (\n\t\t\t\t\t!obstructed1 &&\n\t\t\t\t\trow1 >= 0 &&\n\t\t\t\t\trow1 < 8 &&\n\t\t\t\t\tcol1 >= 0 &&\n\t\t\t\t\tcol1 < 8 &&\n\t\t\t\t\tthis.board.tiles[row1][col1] !== null\n\t\t\t\t) {\n\t\t\t\t\tconst piece = this.board.tiles[row1][col1];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row1 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col1 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row1, col1], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row1;\n\t\t\t\t\t\t\tfrom[1] = col1;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobstructed1 = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t!obstructed2 &&\n\t\t\t\t\trow2 >= 0 &&\n\t\t\t\t\trow2 < 8 &&\n\t\t\t\t\tcol2 >= 0 &&\n\t\t\t\t\tcol2 < 8 &&\n\t\t\t\t\tthis.board.tiles[row2][col2] !== null\n\t\t\t\t) {\n\t\t\t\t\tconst piece = this.board.tiles[row2][col2];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row2 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col2 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row2, col2], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row2;\n\t\t\t\t\t\t\tfrom[1] = col2;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobstructed2 = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn { from, to };\n\t}\n\n\t/**\n\t * Search algorithm to find a piece that can move vertically/horizontally.\n\t * @param {number} tarRow Target row for piece move.\n\t * @param {number} tarCol Target column for piece move.\n\t * @param {number} mustBeInRow Moving piece must be in this row. '-1' if unknown.\n\t * @param {number} mustBeInCol Moving piece must be in this column. '-1' if unknown.\n\t * @param {string} token Moving piece must be of this type, e.g 'R'.\n\t * @returns {Object}\n\t */\n\tfindLine(tarRow, tarCol, mustBeInRow, mustBeInCol, token) {\n\t\tconst color = this.currentMove.player;\n\t\tconst from = [];\n\t\tconst to = [];\n\t\tfrom[0] = -1;\n\t\tfrom[1] = -1;\n\t\tto[0] = tarRow;\n\t\tto[1] = tarCol;\n\n\t\tfor (let i = -1; i <= 1; i += 2) {\n\t\t\tlet obstructed1 = false;\n\t\t\tlet obstructed2 = false;\n\t\t\tfor (let j = 1; j < 8; j += 1) {\n\t\t\t\tconst row1 = to[0];\n\t\t\t\tconst col1 = to[1] - i * j;\n\t\t\t\tconst row2 = to[0] - i * j;\n\t\t\t\tconst col2 = to[1];\n\n\t\t\t\tif (\n\t\t\t\t\t!obstructed1 &&\n\t\t\t\t\trow1 >= 0 &&\n\t\t\t\t\trow1 < 8 &&\n\t\t\t\t\tcol1 >= 0 &&\n\t\t\t\t\tcol1 < 8 &&\n\t\t\t\t\tthis.board.tiles[row1][col1] !== null\n\t\t\t\t) {\n\t\t\t\t\tconst piece = this.board.tiles[row1][col1];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row1 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col1 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row1, col1], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row1;\n\t\t\t\t\t\t\tfrom[1] = col1;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobstructed1 = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\t!obstructed2 &&\n\t\t\t\t\trow2 >= 0 &&\n\t\t\t\t\trow2 < 8 &&\n\t\t\t\t\tcol2 >= 0 &&\n\t\t\t\t\tcol2 < 8 &&\n\t\t\t\t\tthis.board.tiles[row2][col2] !== null\n\t\t\t\t) {\n\t\t\t\t\tconst piece = this.board.tiles[row2][col2];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row2 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col2 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row2, col2], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row2;\n\t\t\t\t\t\t\tfrom[1] = col2;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobstructed2 = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn { from, to };\n\t}\n\n\t/**\n\t * Search algorithm to find a matching knight.\n\t * @param {number} tarRow Target row for piece move.\n\t * @param {number} tarCol Target column for piece move.\n\t * @param {number} mustBeInRow Moving piece must be in this row. '-1' if unknown.\n\t * @param {number} mustBeInCol Moving piece must be in this column. '-1' if unknown.\n\t * @param {string} token Moving piece must be of this type, e.g 'R'.\n\t * @returns {Object}\n\t */\n\tfindKnight(tarRow, tarCol, mustBeInRow, mustBeInCol, token) {\n\t\tconst color = this.currentMove.player;\n\t\tconst from = [];\n\t\tconst to = [];\n\t\tfrom[0] = -1;\n\t\tfrom[1] = -1;\n\t\tto[0] = tarRow;\n\t\tto[1] = tarCol;\n\n\t\tfor (let i = -2; i <= 2; i += 4) {\n\t\t\tfor (let j = -1; j <= 1; j += 2) {\n\t\t\t\tconst row1 = to[0] + i;\n\t\t\t\tconst col1 = to[1] + j;\n\t\t\t\tconst row2 = to[0] + j;\n\t\t\t\tconst col2 = to[1] + i;\n\t\t\t\tif (\n\t\t\t\t\trow1 >= 0 &&\n\t\t\t\t\trow1 < 8 &&\n\t\t\t\t\tcol1 >= 0 &&\n\t\t\t\t\tcol1 < 8 &&\n\t\t\t\t\tthis.board.tiles[row1][col1] !== null\n\t\t\t\t) {\n\t\t\t\t\tconst piece = this.board.tiles[row1][col1];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row1 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col1 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row1, col1], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row1;\n\t\t\t\t\t\t\tfrom[1] = col1;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\trow2 >= 0 &&\n\t\t\t\t\trow2 < 8 &&\n\t\t\t\t\tcol2 >= 0 &&\n\t\t\t\t\tcol2 < 8 &&\n\t\t\t\t\tthis.board.tiles[row2][col2] !== null\n\t\t\t\t) {\n\t\t\t\t\tconst piece = this.board.tiles[row2][col2];\n\t\t\t\t\tif (\n\t\t\t\t\t\tpiece.name.includes(token) &&\n\t\t\t\t\t\tpiece.color === color &&\n\t\t\t\t\t\t(mustBeInRow === -1 || row2 === mustBeInRow) &&\n\t\t\t\t\t\t(mustBeInCol === -1 || col2 === mustBeInCol)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this.checkCheck([row2, col2], [to[0], to[1]])) {\n\t\t\t\t\t\t\tfrom[0] = row2;\n\t\t\t\t\t\t\tfrom[1] = col2;\n\t\t\t\t\t\t\treturn { from, to };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn { from, to };\n\t}\n\n\t/**\n\t * Checks if the input move would be resulting with the king being in check.\n\t * @param {Number[]} from Coordinates of the source tile of the move that shall be checked.\n\t *  @param {Number[]} to Coordinates of the target tile of the move that shall be checked.\n\t * @returns {boolean} After the move, the king will be in check true/false.\n\t */\n\tcheckCheck(from, to) {\n\t\tconst color = this.currentMove.player;\n\t\tconst opColor = this.currentMove.player === 'w' ? 'b' : 'w';\n\t\tconst king = this.board.kingPos[color];\n\t\tlet isInCheck = false;\n\n\t\t// if king move, no check is possible, exit function\n\t\tif (king[0] === from[0] && king[1] === from[1]) return false;\n\n\t\t// check if moving piece is on same line/diag as king, else exit\n\t\tconst diff = [];\n\t\tdiff[0] = from[0] - king[0];\n\t\tdiff[1] = from[1] - king[1];\n\t\tconst checkFor = [];\n\t\tif (diff[0] === 0 || diff[1] === 0) {\n\t\t\tcheckFor[0] = 'Q';\n\t\t\tcheckFor[1] = 'R';\n\t\t} else if (Math.abs(diff[0]) === Math.abs(diff[1])) {\n\t\t\tcheckFor[0] = 'Q';\n\t\t\tcheckFor[1] = 'B';\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\tif (diff[0] !== 0) diff[0] /= Math.abs(diff[0]);\n\t\tif (diff[1] !== 0) diff[1] /= Math.abs(diff[1]);\n\n\t\tconst srcTilePiece = this.board.tiles[from[0]][from[1]];\n\t\tconst tarTilePiece = this.board.tiles[to[0]][to[1]];\n\n\t\t// premove and check if check\n\t\tthis.board.tiles[from[0]][from[1]] = null;\n\t\tthis.board.tiles[to[0]][to[1]] = srcTilePiece;\n\n\t\t// check for check\n\t\tlet obstructed = false;\n\t\tfor (let j = 1; j < 8 && !isInCheck && !obstructed; j += 1) {\n\t\t\tconst row = king[0] + j * diff[0];\n\t\t\tconst col = king[1] + j * diff[1];\n\n\t\t\tif (\n\t\t\t\trow >= 0 &&\n\t\t\t\trow < 8 &&\n\t\t\t\tcol >= 0 &&\n\t\t\t\tcol < 8 &&\n\t\t\t\tthis.board.tiles[row][col] !== null\n\t\t\t) {\n\t\t\t\tconst piece = this.board.tiles[row][col];\n\t\t\t\tif (\n\t\t\t\t\t(piece.name.includes(checkFor[0]) ||\n\t\t\t\t\t\tpiece.name.includes(checkFor[1])) &&\n\t\t\t\t\tpiece.color === opColor\n\t\t\t\t) {\n\t\t\t\t\tisInCheck = true;\n\t\t\t\t} else {\n\t\t\t\t\tobstructed = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.board.tiles[from[0]][from[1]] = srcTilePiece;\n\t\tthis.board.tiles[to[0]][to[1]] = tarTilePiece;\n\n\t\treturn isInCheck;\n\t}\n\n\tstatic algebraicToCoords(square) {\n\t\tconst coords = [];\n\t\tconst temp = square.split('');\n\t\tcoords.push(8 - temp[1]);\n\t\tcoords.push(files.indexOf(temp[0]));\n\n\t\treturn coords;\n\t}\n\n\tstatic coordsToAlgebraic(coords) {\n\t\tlet name = files[coords[1]];\n\t\tname += 8 - coords[0];\n\n\t\treturn name;\n\t}\n\n\t/**\n\t * Removes special characters like '#', '+', '?' and '!'\n\t * @param {string} move The move to be cleaned up\n\t * @returns {string} The input string with removed special characters\n\t */\n\tstatic preProcess(move) {\n\t\treturn move.replace(/#|\\+|\\?|!/g, '');\n\t}\n}\n\nexport default GameProcessor;\n","/* eslint-disable global-require */\n/* eslint-disable import/no-dynamic-require */\n/* eslint-disable no-undef */\n\nimport GameProcessor from './GameProcessor';\nimport Chessalyzer from './Chessalyzer';\n\nconst { Tracker } = Chessalyzer;\n\nprocess.on('message', msg => {\n\tconst TrackerList = {};\n\tconst proc = new GameProcessor();\n\n\tObject.keys(Tracker).forEach(key => {\n\t\tTrackerList[Tracker[key].name] = Tracker[key];\n\t});\n\n\t// merge available Trackers\n\tif (msg.customPath !== '') {\n\t\tconst TrackerListCustom = __non_webpack_require__(msg.customPath);\n\n\t\tObject.keys(TrackerListCustom).forEach(key => {\n\t\t\tTrackerList[TrackerListCustom[key].name] = TrackerListCustom[key];\n\t\t});\n\t}\n\n\t// select needed analyzers\n\tconst analyzer = [];\n\tmsg.analyzerNames.forEach(name => {\n\t\tanalyzer.push(new TrackerList[name]());\n\t});\n\n\tproc.attachAnalyzers(analyzer);\n\n\t// analyze each game\n\tmsg.games.forEach(game => {\n\t\tproc.processGame(game);\n\t});\n\n\t// send result of batch to master\n\tprocess.send({\n\t\tcntMoves: proc.cntMoves,\n\t\tgameAnalyzers: proc.gameAnalyzers,\n\t\tmoveAnalyzers: proc.moveAnalyzers\n\t});\n});\n","const { performance } = require('perf_hooks');\n\nclass BaseTracker {\n\tconstructor(type) {\n\t\tthis.type = type;\n\t\tthis.profilingActive = false;\n\t\tthis.time = 0;\n\t\tthis.t0 = 0;\n\n\t\tif (this.track === undefined) {\n\t\t\tthrow new Error('Your analyzer must implement a track() method!');\n\t\t}\n\t\tif (this.type === undefined) {\n\t\t\tthrow new Error('Your analyzer must specify a type!');\n\t\t}\n\t}\n\n\tanalyze(data) {\n\t\tif (this.profilingActive) this.t0 = performance.now();\n\t\tthis.track(data);\n\t\tif (this.profilingActive) this.time += performance.now() - this.t0;\n\t}\n}\n\nexport default BaseTracker;\n","import BaseTracker from './BaseTracker';\n\nclass GameTrackerBase extends BaseTracker {\n\tconstructor() {\n\t\tsuper('game');\n\t\tthis.wins = [0, 0, 0];\n\t\tthis.cntGames = 0;\n\t}\n\n\tadd(tracker) {\n\t\tthis.wins[0] += tracker.wins[0];\n\t\tthis.wins[1] += tracker.wins[1];\n\t\tthis.wins[2] += tracker.wins[2];\n\t\tthis.cntGames += tracker.cntGames;\n\t\tthis.time += tracker.time;\n\t}\n\n\ttrack(game) {\n\t\tthis.cntGames += 1;\n\t\tswitch (game.Result) {\n\t\t\tcase '1-0':\n\t\t\t\tthis.wins[0] += 1;\n\t\t\t\tbreak;\n\n\t\t\tcase '1/2-1/2':\n\t\t\t\tthis.wins[1] += 1;\n\t\t\t\tbreak;\n\n\t\t\tcase '0-1':\n\t\t\t\tthis.wins[2] += 1;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport default GameTrackerBase;\n","import BaseTracker from './BaseTracker';\n\nconst pawnTemplate = ['Pa', 'Pb', 'Pc', 'Pd', 'Pe', 'Pf', 'Pg', 'Ph'];\nconst pieceTemplate = ['Ra', 'Nb', 'Bc', 'Qd', 'Ke', 'Bf', 'Ng', 'Rh'];\n\nclass PieceTrackerBase extends BaseTracker {\n\tconstructor() {\n\t\tsuper('move');\n\t\tthis.b = {};\n\t\tthis.w = {};\n\n\t\t// first layer\n\t\tpawnTemplate.forEach(val => {\n\t\t\tthis.w[val] = {};\n\t\t\tthis.b[val] = {};\n\t\t});\n\t\tpieceTemplate.forEach(val => {\n\t\t\tthis.w[val] = {};\n\t\t\tthis.b[val] = {};\n\t\t});\n\n\t\t// second layer\n\t\tObject.keys(this.w).forEach(key => {\n\t\t\tpawnTemplate.forEach(val => {\n\t\t\t\tthis.w[key][val] = 0;\n\t\t\t\tthis.b[key][val] = 0;\n\t\t\t});\n\t\t\tpieceTemplate.forEach(val => {\n\t\t\t\tthis.w[key][val] = 0;\n\t\t\t\tthis.b[key][val] = 0;\n\t\t\t});\n\t\t});\n\t}\n\n\tadd(tracker) {\n\t\tthis.time += tracker.time;\n\n\t\tpawnTemplate.forEach(pawn => {\n\t\t\tpieceTemplate.forEach(piece => {\n\t\t\t\tthis.w[pawn][piece] += tracker.w[pawn][piece];\n\t\t\t\tthis.b[pawn][piece] += tracker.b[pawn][piece];\n\t\t\t});\n\t\t\tpawnTemplate.forEach(pawn2 => {\n\t\t\t\tthis.w[pawn][pawn2] += tracker.w[pawn][pawn2];\n\t\t\t\tthis.b[pawn][pawn2] += tracker.b[pawn][pawn2];\n\t\t\t});\n\t\t});\n\t\tpieceTemplate.forEach(piece => {\n\t\t\tpieceTemplate.forEach(piece2 => {\n\t\t\t\tthis.w[piece][piece2] += tracker.w[piece][piece2];\n\t\t\t\tthis.b[piece][piece2] += tracker.b[piece][piece2];\n\t\t\t});\n\t\t\tpawnTemplate.forEach(pawn => {\n\t\t\t\tthis.w[piece][pawn] += tracker.w[piece][pawn];\n\t\t\t\tthis.b[piece][pawn] += tracker.b[piece][pawn];\n\t\t\t});\n\t\t});\n\t}\n\n\ttrack(moveData) {\n\t\tconst { player } = moveData;\n\t\tconst { piece } = moveData;\n\t\tconst { takes } = moveData;\n\n\t\tif (takes.piece !== undefined) {\n\t\t\tif (piece.length > 1 && takes.piece.length > 1) {\n\t\t\t\tthis.processTakes(player, piece, takes.piece);\n\t\t\t}\n\t\t}\n\t}\n\n\tprocessTakes(player, takingPiece, takenPiece) {\n\t\tthis[player][takingPiece][takenPiece] += 1;\n\t}\n}\nexport default PieceTrackerBase;\n","import BaseTracker from './BaseTracker';\n\nconst pawnTemplate = ['Pa', 'Pb', 'Pc', 'Pd', 'Pe', 'Pf', 'Pg', 'Ph'];\nconst pieceTemplate = ['Ra', 'Nb', 'Bc', 'Qd', 'Ke', 'Bf', 'Ng', 'Rh'];\n\nclass TileStats {\n\tconstructor() {\n\t\tthis.movedTo = 0;\n\t\tthis.wasOn = 0;\n\t\tthis.killedOn = 0;\n\t\tthis.wasKilledOn = 0;\n\t}\n}\n\nclass Piece {\n\tconstructor(piece, color) {\n\t\tthis.piece = piece;\n\t\tthis.color = color;\n\t\tthis.lastMovedOn = 0;\n\t}\n}\n\nclass TileTrackerBase extends BaseTracker {\n\tconstructor() {\n\t\tsuper('move');\n\t\tthis.cntMovesGame = 0;\n\t\tthis.cntMovesTotal = 0;\n\t\tthis.tiles = new Array(8);\n\t\tfor (let row = 0; row < 8; row += 1) {\n\t\t\tconst currRow = new Array(8);\n\t\t\tfor (let col = 0; col < 8; col += 1) {\n\t\t\t\tcurrRow[col] = { b: {}, w: {} };\n\n\t\t\t\tcurrRow[col].b = new TileStats();\n\t\t\t\tcurrRow[col].w = new TileStats();\n\t\t\t\tpawnTemplate.forEach(val => {\n\t\t\t\t\tcurrRow[col].b[val] = new TileStats();\n\t\t\t\t\tcurrRow[col].w[val] = new TileStats();\n\t\t\t\t});\n\t\t\t\tpieceTemplate.forEach(val => {\n\t\t\t\t\tcurrRow[col].b[val] = new TileStats();\n\t\t\t\t\tcurrRow[col].w[val] = new TileStats();\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.tiles[row] = currRow;\n\t\t}\n\n\t\tfor (let row = 0; row < 8; row += 1) {\n\t\t\tfor (let col = 0; col < 8; col += 1) {\n\t\t\t\tthis.resetCurrentPiece(row, col);\n\t\t\t}\n\t\t}\n\t}\n\n\tadd(tracker) {\n\t\tthis.time += tracker.time;\n\n\t\tfor (let row = 0; row < 8; row += 1) {\n\t\t\tfor (let col = 0; col < 8; col += 1) {\n\t\t\t\tthis.tiles[row][col].b.movedTo +=\n\t\t\t\t\ttracker.tiles[row][col].b.movedTo;\n\t\t\t\tthis.tiles[row][col].w.movedTo +=\n\t\t\t\t\ttracker.tiles[row][col].w.movedTo;\n\n\t\t\t\tthis.tiles[row][col].b.wasOn += tracker.tiles[row][col].b.wasOn;\n\t\t\t\tthis.tiles[row][col].w.wasOn += tracker.tiles[row][col].w.wasOn;\n\n\t\t\t\tthis.tiles[row][col].b.killedOn +=\n\t\t\t\t\ttracker.tiles[row][col].b.killedOn;\n\t\t\t\tthis.tiles[row][col].w.killedOn +=\n\t\t\t\t\ttracker.tiles[row][col].w.killedOn;\n\n\t\t\t\tthis.tiles[row][col].b.wasKilledOn +=\n\t\t\t\t\ttracker.tiles[row][col].b.wasKilledOn;\n\t\t\t\tthis.tiles[row][col].w.wasKilledOn +=\n\t\t\t\t\ttracker.tiles[row][col].w.wasKilledOn;\n\n\t\t\t\tpawnTemplate.forEach(piece => {\n\t\t\t\t\tthis.tiles[row][col].b[piece].movedTo +=\n\t\t\t\t\t\ttracker.tiles[row][col].b[piece].movedTo;\n\t\t\t\t\tthis.tiles[row][col].w[piece].movedTo +=\n\t\t\t\t\t\ttracker.tiles[row][col].w[piece].movedTo;\n\n\t\t\t\t\tthis.tiles[row][col].b[piece].wasOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].b[piece].wasOn;\n\t\t\t\t\tthis.tiles[row][col].w[piece].wasOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].w[piece].wasOn;\n\n\t\t\t\t\tthis.tiles[row][col].b[piece].killedOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].b[piece].killedOn;\n\t\t\t\t\tthis.tiles[row][col].w[piece].killedOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].w[piece].killedOn;\n\n\t\t\t\t\tthis.tiles[row][col].b[piece].wasKilledOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].b[piece].wasKilledOn;\n\t\t\t\t\tthis.tiles[row][col].w[piece].wasKilledOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].w[piece].wasKilledOn;\n\t\t\t\t});\n\n\t\t\t\tpieceTemplate.forEach(piece => {\n\t\t\t\t\tthis.tiles[row][col].b[piece].movedTo +=\n\t\t\t\t\t\ttracker.tiles[row][col].b[piece].movedTo;\n\t\t\t\t\tthis.tiles[row][col].w[piece].movedTo +=\n\t\t\t\t\t\ttracker.tiles[row][col].w[piece].movedTo;\n\n\t\t\t\t\tthis.tiles[row][col].b[piece].wasOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].b[piece].wasOn;\n\t\t\t\t\tthis.tiles[row][col].w[piece].wasOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].w[piece].wasOn;\n\n\t\t\t\t\tthis.tiles[row][col].b[piece].killedOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].b[piece].killedOn;\n\t\t\t\t\tthis.tiles[row][col].w[piece].killedOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].w[piece].killedOn;\n\n\t\t\t\t\tthis.tiles[row][col].b[piece].wasKilledOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].b[piece].wasKilledOn;\n\t\t\t\t\tthis.tiles[row][col].w[piece].wasKilledOn +=\n\t\t\t\t\t\ttracker.tiles[row][col].w[piece].wasKilledOn;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tresetCurrentPiece(row, col) {\n\t\tlet color;\n\t\tlet piece;\n\t\tlet hasPiece = false;\n\n\t\tif (row === 0) {\n\t\t\tcolor = 'b';\n\t\t\tpiece = pieceTemplate[col];\n\t\t\thasPiece = true;\n\t\t} else if (row === 1) {\n\t\t\tcolor = 'b';\n\t\t\tpiece = pawnTemplate[col];\n\t\t\thasPiece = true;\n\t\t} else if (row === 6) {\n\t\t\tcolor = 'w';\n\t\t\tpiece = pawnTemplate[col];\n\t\t\thasPiece = true;\n\t\t} else if (row === 7) {\n\t\t\tcolor = 'w';\n\t\t\tpiece = pieceTemplate[col];\n\t\t\thasPiece = true;\n\t\t}\n\n\t\tif (hasPiece) {\n\t\t\tthis.tiles[row][col].currentPiece = new Piece(piece, color);\n\t\t} else {\n\t\t\tthis.tiles[row][col].currentPiece = null;\n\t\t}\n\t}\n\n\ttrack(moveData) {\n\t\tconst { to } = moveData;\n\t\tconst { from } = moveData;\n\t\tconst { player } = moveData;\n\t\tconst { piece } = moveData;\n\t\tconst { takes } = moveData;\n\t\tconst { castles } = moveData;\n\n\t\t// move\n\t\tif (to[0] !== -1) {\n\t\t\tthis.cntMovesGame += 1;\n\n\t\t\tif (takes.piece !== undefined) {\n\t\t\t\tthis.processTakes(takes.pos, player, piece, takes.piece);\n\t\t\t}\n\n\t\t\tthis.processMove(from, to, player, piece);\n\n\t\t\t// castle\n\t\t} else if (castles !== '') {\n\t\t\tthis.cntMovesGame += 1;\n\n\t\t\tconst row = player === 'w' ? 7 : 0;\n\t\t\tlet rook = 'Rh';\n\t\t\tlet tarKingCol = 6;\n\t\t\tlet tarRookCol = 5;\n\t\t\tlet srcRookCol = 7;\n\t\t\tif (castles === 'O-O-O') {\n\t\t\t\ttarKingCol = 2;\n\t\t\t\ttarRookCol = 3;\n\t\t\t\tsrcRookCol = 0;\n\t\t\t\trook = 'Ra';\n\t\t\t}\n\t\t\tthis.processMove([row, 4], [row, tarKingCol], player, 'Ke');\n\t\t\tthis.processMove(\n\t\t\t\t[row, srcRookCol],\n\t\t\t\t[row, tarRookCol],\n\t\t\t\tplayer,\n\t\t\t\trook\n\t\t\t);\n\n\t\t\t// game end\n\t\t} else {\n\t\t\tfor (let row = 0; row < 8; row += 1) {\n\t\t\t\tfor (let col = 0; col < 8; col += 1) {\n\t\t\t\t\tconst { currentPiece } = this.tiles[row][col];\n\t\t\t\t\tif (currentPiece !== null) {\n\t\t\t\t\t\tthis.addOccupation([row, col]);\n\t\t\t\t\t}\n\t\t\t\t\tthis.resetCurrentPiece(row, col);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.cntMovesTotal += this.cntMovesGame;\n\t\t\tthis.cntMovesGame = 0;\n\t\t}\n\t}\n\n\tprocessMove(from, to, player, piece) {\n\t\tif (piece.length > 1) {\n\t\t\tthis.addOccupation(from);\n\n\t\t\tthis.tiles[to[0]][to[1]].currentPiece = this.tiles[from[0]][\n\t\t\t\tfrom[1]\n\t\t\t].currentPiece;\n\t\t\tthis.tiles[to[0]][\n\t\t\t\tto[1]\n\t\t\t].currentPiece.lastMovedOn = this.cntMovesGame;\n\n\t\t\tthis.tiles[from[0]][from[1]].currentPiece = null;\n\n\t\t\tthis.tiles[to[0]][to[1]][player].movedTo += 1;\n\t\t\tthis.tiles[to[0]][to[1]][player][piece].movedTo += 1;\n\t\t}\n\t}\n\n\tprocessTakes(pos, player, takingPiece, takenPiece) {\n\t\tif (takenPiece.length > 1) {\n\t\t\tconst opPlayer = player === 'w' ? 'b' : 'w';\n\t\t\tthis.tiles[pos[0]][pos[1]][opPlayer].wasKilledOn += 1;\n\t\t\tthis.tiles[pos[0]][pos[1]][opPlayer][takenPiece].wasKilledOn += 1;\n\n\t\t\tthis.addOccupation(pos);\n\t\t\tthis.tiles[pos[0]][pos[1]].currentPiece = null;\n\t\t}\n\n\t\tif (takingPiece.length > 1) {\n\t\t\tthis.tiles[pos[0]][pos[1]][player].killedOn += 1;\n\t\t\tthis.tiles[pos[0]][pos[1]][player][takingPiece].killedOn += 1;\n\t\t}\n\t}\n\n\taddOccupation(pos) {\n\t\tconst { currentPiece } = this.tiles[pos[0]][pos[1]];\n\t\tconst toAdd = this.cntMovesGame - currentPiece.lastMovedOn;\n\t\tthis.tiles[pos[0]][pos[1]][currentPiece.color].wasOn += toAdd;\n\t\tthis.tiles[pos[0]][pos[1]][currentPiece.color][\n\t\t\tcurrentPiece.piece\n\t\t].wasOn += toAdd;\n\t}\n}\n\nexport default TileTrackerBase;\n","module.exports = require(\"cluster\");","module.exports = require(\"events\");","module.exports = require(\"fs\");","module.exports = require(\"line-by-line\");","module.exports = require(\"perf_hooks\");"],"sourceRoot":""}