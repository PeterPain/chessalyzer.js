module.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=9)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(i(6)),r=s(i(5));function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=["Pa","Pb","Pc","Pd","Pe","Pf","Pg","Ph"],l=["Ra","Nb","Bc","Qd","Ke","Bf","Ng","Rh"],c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cntMoves=0,this.cntGames=0,this.pieces=[],this.tiles=new Array(8);for(var t=0;t<8;t+=1){for(var i=new Array(8),s=0;s<8;s+=1)i[s]=new n.default,0===t||7===t?(this.pieces.push(new r.default(l[s],[t,s])),i[s].initPiece(this.pieces[this.pieces.length-1])):1!==t&&6!==t||(this.pieces.push(new r.default(a[s],[t,s])),i[s].initPiece(this.pieces[this.pieces.length-1]));this.tiles[t]=i}}return function(e,t,i){t&&o(e.prototype,t),i&&o(e,i)}(e,[{key:"move",value:function(e){if(null!==e){if(this.cntMoves+=1,1===e.moves.length){var t=e.moves[0];e.takes&&null===this.tiles[t.to[0]][t.to[1]].piece&&(this.tiles[t.from[0]][t.from[1]].piece.color,this.tiles[t.to[0]+1][t.to[1]].piece.alive=!1,this.tiles[t.to[0]+1][t.to[1]].piece=null),this.processMove(t),null!==e.promotes&&this.promotePiece(t.to,e.promotes)}else this.processMove(e.moves[0]),this.processMove(e.moves[1]);this.updateTileStats()}}},{key:"processMove",value:function(e){var t=e.from,i=e.to;null!==this.tiles[i[0]][i[1]].piece&&(this.tiles[i[0]][i[1]].piece.killPiece(this.tiles[t[0]][t[1]].piece),this.tiles[t[0]][t[1]].piece.killedPiece(this.tiles[i[0]][i[1]].piece)),this.tiles[i[0]][i[1]].piece=this.tiles[t[0]][t[1]].piece,this.tiles[i[0]][i[1]].piece.updatePosition(i),this.tiles[t[0]][t[1]].piece=null}},{key:"reset",value:function(){this.cntGames+=1;for(var e=0;e<this.pieces.length;e+=1)this.pieces[e].reset();this.pieces=this.pieces.slice(0,32);for(var t=0;t<8;t+=1)for(var i=0;i<8;i+=1)this.tiles[t][i].resetPiece()}},{key:"resetStats",value:function(){for(var e=0;e<8;e+=1)for(var t=0;t<8;t+=1)this.tiles[e][t].initStats();for(var i=0;i<this.pieces.length;i+=1)this.pieces[i].initStats();this.cntMoves=0,this.cntGames=0}},{key:"promotePiece",value:function(e,t){this.tiles[e[0]][e[1]].piece.alive=!1,this.tiles[e[0]][e[1]].piece=null,this.pieces.push(new r.default(t,[e[0],e[1]],!0)),this.tiles[e[0]][e[1]].piece=this.pieces[this.pieces.length-1]}},{key:"printPosition",value:function(){for(var e=0;e<8;e+=1){for(var t=[],i=0;i<8;i+=1){var n=this.tiles[e][i].piece;null!==n?t.push(n.name):t.push("..")}console.log(t)}}},{key:"updateTileStats",value:function(){for(var e=0;e<32;e+=1)this.pieces[e].alive&&this.tiles[this.pieces[e].pos[0]][this.pieces[e].pos[1]].updateStats()}}]),e}();t.default=c,e.exports=t.default},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("perf_hooks")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("line-by-line")},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.pos=i,this.defaultPos=i,this.color=n?this.defaultPos[0]<=1?"white":"black":this.defaultPos[0]<=1?"black":"white",this.history=[],this.history.push(i),this.dataMap=null,this.cntMoved=0,this.cntWasKilled=0,this.cntHasKilled=0,this.initStats(),this.alive=!0,this.logHistory=!1,this.maxHistory=2e3}return function(e,t,i){t&&n(e.prototype,t),i&&n(e,i)}(e,[{key:"reset",value:function(){this.logHistory&&this.history.length<this.maxHistory&&(this.history.push(null),this.history.push(this.defaultPos)),this.pos=this.defaultPos,this.alive=!0}},{key:"updatePosition",value:function(e){this.cntMoved+=1,this.pos=e,this.logHistory&&this.history.length<this.maxHistory&&this.history.push(e),this.dataMap[e[0]][e[1]][0]+=1}},{key:"killPiece",value:function(e){this.alive=!1,this.cntWasKilled+=1,1!==e.name.length&&1!==this.name.length&&(this.dataMap[e.defaultPos[0]][e.defaultPos[1]][1]+=1)}},{key:"killedPiece",value:function(e){this.cntHasKilled+=1,1!==e.name.length&&1!==this.name.length&&(this.dataMap[e.defaultPos[0]][e.defaultPos[1]][2]+=1)}},{key:"initStats",value:function(){this.cntMoved=0,this.cntWasKilled=0,this.cntHasKilled=0,this.dataMap=new Array(8);for(var e=0;e<8;e+=1){for(var t=new Array(8),i=0;i<8;i+=1)t[i]=[0,0,0];this.dataMap[e]=t}}}]),e}();t.default=r,e.exports=t.default},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.piece=null,this.defaultPiece=null,this.dataMap=null,this.initStats(),this.cntHasPiece=[0,0]}return function(e,t,i){t&&n(e.prototype,t),i&&n(e,i)}(e,[{key:"initPiece",value:function(e){this.piece=e,this.defaultPiece=e}},{key:"resetPiece",value:function(){this.piece=this.defaultPiece}},{key:"updateStats",value:function(){var e="white"===this.piece.color?0:1;this.cntHasPiece[e]+=1,1!==this.piece.name.length&&(this.dataMap[this.piece.defaultPos[0]][this.piece.defaultPos[1]][0]+=1)}},{key:"initStats",value:function(){this.cntHasPiece=[0,0],this.dataMap=new Array(8);for(var e=0;e<8;e+=1){for(var t=new Array(8),i=0;i<8;i+=1)t[i]=[0,0];this.dataMap[e]=t}}}]),e}();t.default=r,e.exports=t.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(i(0));function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=i(4),c=i(3),u="abcdefgh",f=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).board=new n.default,e.activePlayer=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,c),function(e,t,i){t&&s(e.prototype,t),i&&s(e,i)}(t,[{key:"processPGN",value:function(e,t){var i=this;return new Promise(function(n,r){var s=new l(e),o={moves:""},a=0,c=0,u=i;s.on("error",function(e){console.log(e),r()}),s.on("line",function(e){s.pause(),function(e){var i;if(e.startsWith("[")){var n=(i=(i=e.replace(/[[\]']+/g,"")).split(' "'))[0],r=i[1].replace('"',"");"Site"===n?(r=r.replace("https://lichess.org/",""),n="id"):"UTCDate"===n?n="Date":"Event"===n&&(r=(r=r.replace("Rated","R").replace("Unrated","U").replace(" game","")).replace(/\s+tournament.*$/,"")),"WhiteElo"!==n&&"BlackElo"!==n||(r=+r),"UTCTime"!==n&&"WhiteRatingDiff"!==n&&"BlackRatingDiff"!==n&&"Opening"!==n&&(o[n]=r)}else""===e&&1===c?c=0:""===e&&0===c?c+=1:e.startsWith("1")&&(o.moves=e.replace(/\{.*?\}\s/g,"").replace(/\d+\.+\s/g,""),"?"!==o.white&&"?"!==o.black&&(u.processGame(o),a+=1),a%t==0&&u.emit("status",a),o={moves:""})}(e),s.resume()}),s.on("end",function(){console.log("Read entire file."),n(a)})})}},{key:"processGame",value:function(e){for(var t=e.moves.split(" "),i=0;i<t.length;i+=1){this.activePlayer=i%2;var n=this.parseMove(t[i]);this.board.move(n)}this.board.reset()}},{key:"reset",value:function(){this.board.reset(),this.board.resetStats(),this.activePlayer=0}},{key:"parseMove",value:function(e){var i=e.substring(0,1),n=t.preProcess(e);return null!==i.match(/\d/)?null:i.toLowerCase()===i?this.pawnMove(n):"O"===i?this.castle(n):this.pieceMove(n)}},{key:"pawnMove",value:function(e){var t=[],i=[],n={moves:[],takes:!1,promotes:null},r=this.activePlayer%2*-2+1,s=e;if(s.includes("x"))n.takes=!0,s=s.replace("x",""),i[0]=8-parseInt(s.substring(2,3),10),i[1]=u.indexOf(s.substring(1,2)),t[0]=i[0]+r,t[1]=u.indexOf(s.substring(0,1));else{var o=8-parseInt(s.substring(1,2),10),a=u.indexOf(s.substring(0,1));t[1]=a,i[0]=o,i[1]=a;for(var l=o+r;l<8&&l>=0;l+=r)if(null!==this.board.tiles[l][a].piece&&this.board.tiles[l][a].piece.name.includes("P")){t[0]=l;break}}return n.moves.push({from:t,to:i}),s.includes("=")&&(n.promotes=s.substring(s.length-1,s.length)),n}},{key:"pieceMove",value:function(e){var t=[],i=[],n={moves:[],takes:!1,promotes:null},r=e,s=r.substring(0,1);if((r=r.substring(1,r.length)).includes("x")&&(n.takes=!0,r=r.replace("x","")),4===r.length)t[0]=8-parseInt(r.substring(1,2),10),t[1]=u.indexOf(r.substring(0,1)),i[0]=8-parseInt(r.substring(3,4),10),i[1]=u.indexOf(r.substring(2,3)),n.moves.push({from:t,to:i});else if(3===r.length){var o=8-parseInt(r.substring(2,3),10),a=u.indexOf(r.substring(1,2)),l=-1,c=-1;u.indexOf(r.substring(0,1))>=0?c=u.indexOf(r.substring(0,1)):l=8-parseInt(r.substring(0,1),10),n.moves.push(this.findPiece(o,a,l,c,s))}else{var f=8-parseInt(r.substring(1,2),10),h=u.indexOf(r.substring(0,1));n.moves.push(this.findPiece(f,h,-1,-1,s))}return n}},{key:"findPiece",value:function(e,t,i,n,r){var s={};return"R"===r?s=this.findLine(e,t,i,n,r):"B"===r?s=this.findDiag(e,t,i,n,r):"Q"===r||"K"===r?-1===(s=this.findDiag(e,t,i,n,r)).from[0]&&(s=this.findLine(e,t,i,n,r)):"N"===r&&(s=this.findKnight(e,t,i,n,r)),-1===s.from[0]&&(console.log("Error: no piece for move ".concat(r," to (").concat(e,",").concat(t,") found!")),this.board.printPosition()),s}},{key:"findDiag",value:function(e,t,i,n,r){var s=this.activePlayer%2?"black":"white",o=[],a=[];o[0]=-1,o[1]=-1,a[0]=e,a[1]=t;for(var l=-1;l<=1;l+=2)for(var c=!1,u=!1,f=1;f<8;f+=1){var h=a[0]+l*f,p=a[1]+f,v=a[0]-l*f,d=a[1]-f;if(h>=0&&h<8&&p>=0&&p<8&&!c&&null!==this.board.tiles[h][p].piece){var b=this.board.tiles[h][p].piece;if(!b.name.includes(r)||b.color!==s||-1!==i&&h!==i||-1!==n&&p!==n)c=!0;else if(!this.checkCheck([h,p,a[0],a[1]]))return o[0]=h,o[1]=p,{from:o,to:a}}if(v>=0&&v<8&&d>=0&&d<8&&!u&&null!==this.board.tiles[v][d].piece){var y=this.board.tiles[v][d].piece;if(!y.name.includes(r)||y.color!==s||-1!==i&&v!==i||-1!==n&&d!==n)u=!0;else if(!this.checkCheck([v,d,a[0],a[1]]))return o[0]=v,o[1]=d,{from:o,to:a}}}return{from:o,to:a}}},{key:"findLine",value:function(e,t,i,n,r){var s=this.activePlayer%2?"black":"white",o=[],a=[];o[0]=-1,o[1]=-1,a[0]=e,a[1]=t;for(var l=-1;l<=1;l+=2)for(var c=!1,u=!1,f=1;f<8;f+=1){var h=a[0],p=a[1]-l*f,v=a[0]-l*f,d=a[1];if(h>=0&&h<8&&p>=0&&p<8&&!c&&null!==this.board.tiles[h][p].piece){var b=this.board.tiles[h][p].piece;if(!b.name.includes(r)||b.color!==s||-1!==i&&h!==i||-1!==n&&p!==n)c=!0;else if(!this.checkCheck([h,p,a[0],a[1]]))return o[0]=h,o[1]=p,{from:o,to:a}}if(v>=0&&v<8&&d>=0&&d<8&&!u&&null!==this.board.tiles[v][d].piece){var y=this.board.tiles[v][d].piece;if(!y.name.includes(r)||y.color!==s||-1!==i&&v!==i||-1!==n&&d!==n)u=!0;else if(!this.checkCheck([v,d,a[0],a[1]]))return o[0]=v,o[1]=d,{from:o,to:a}}}return{from:o,to:a}}},{key:"findKnight",value:function(e,t,i,n,r){var s=this.activePlayer%2?"black":"white",o=[],a=[];o[0]=-1,o[1]=-1,a[0]=e,a[1]=t;for(var l=-2;l<=2;l+=4)for(var c=-1;c<=1;c+=2){var u=a[0]+l,f=a[1]+c,h=a[0]+c,p=a[1]+l;if(u>=0&&u<8&&f>=0&&f<8&&null!==this.board.tiles[u][f].piece){var v=this.board.tiles[u][f].piece;if(v.name.includes(r)&&v.color===s&&(-1===i||u===i)&&(-1===n||f===n)&&!this.checkCheck([u,f,a[0],a[1]]))return o[0]=u,o[1]=f,{from:o,to:a}}if(h>=0&&h<8&&p>=0&&p<8&&null!==this.board.tiles[h][p].piece){var d=this.board.tiles[h][p].piece;if(d.name.includes(r)&&d.color===s&&(-1===i||h===i)&&(-1===n||p===n)&&!this.checkCheck([h,p,a[0],a[1]]))return o[0]=h,o[1]=p,{from:o,to:a}}}return{from:o,to:a}}},{key:"checkCheck",value:function(e){var t=e.slice(0,2),i=e.slice(2),n=this.activePlayer%2?"black":"white",r=this.activePlayer%2?"white":"black",s=this.board.pieces["white"===n?28:4].pos,o=!1;if(s[0]===t[0]&&s[1]===t[1])return!1;var a=[];a[0]=t[0]-s[0],a[1]=t[1]-s[1];var l=[];if(0===a[0]||0===a[1])l[0]="Q",l[1]="R";else{if(Math.abs(a[0])!==Math.abs(a[1]))return!1;l[0]="Q",l[1]="B"}0!==a[0]&&(a[0]/=Math.abs(a[0])),0!==a[1]&&(a[1]/=Math.abs(a[1]));var c=this.board.tiles[t[0]][t[1]].piece,u=this.board.tiles[i[0]][i[1]].piece;this.board.tiles[t[0]][t[1]].piece=null,this.board.tiles[i[0]][i[1]].piece=c;for(var f=!1,h=1;h<8&&!o&&!f;h+=1){var p=s[0]+h*a[0],v=s[1]+h*a[1];if(p>=0&&p<8&&v>=0&&v<8&&null!==this.board.tiles[p][v].piece){var d=this.board.tiles[p][v].piece;(d.name.includes(l[0])||d.name.includes(l[1]))&&d.color===r?o=!0:f=!0}}return this.board.tiles[t[0]][t[1]].piece=c,this.board.tiles[i[0]][i[1]].piece=u,o}},{key:"castle",value:function(e){var t=this.activePlayer%2?0:7,i=[],n=[],r=[],s=[],o={moves:[],takes:!1,promotes:null};return 3===e.length?(i[0]=t,i[1]=4,r[0]=t,r[1]=6,n[0]=t,n[1]=7,s[0]=t,s[1]=5):(i[0]=t,i[1]=4,r[0]=t,r[1]=2,n[0]=t,n[1]=0,s[0]=t,s[1]=3),o.moves.push({from:i,to:r}),o.moves.push({from:n,to:s}),o}}],[{key:"algebraicToCoords",value:function(e){var t=[],i=e.split("");return t.push(8-i[1]),t.push(u.indexOf(i[0])),t}},{key:"coordsToAlgebraic",value:function(e){var t=u[e[1]];return t+=8-e[0]}},{key:"preProcess",value:function(e){return e.replace(/#|\+|\?|!/g,"")}}]),t}();t.default=f,e.exports=t.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(i(7));function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=i(2).performance,o=i(1),a=["Pa","Pb","Pc","Pd","Pe","Pf","Pg","Ph"],l=["Ra","Nb","Bc","Qd","Ke","Bf","Ng","Rh"],c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ds=new Array(2),this.gp=new n.default}return function(e,t,i){t&&r(e.prototype,t),i&&r(e,i)}(e,[{key:"startBatch",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250;return new Promise(function(r){var o=s.now();t.gp.processPGN(e,n).then(function(e){t.ds[i]=JSON.parse(JSON.stringify(t.gp.board));var n=s.now(),a=Math.round(n-o)/1e3,l=Math.round(t.gp.board.cntMoves/a);console.log("".concat(t.gp.board.cntMoves," moves processed in ").concat(a,"s (").concat(l," moves/s)")),t.gp.reset(),r(e)})})}},{key:"saveAnalysis",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;o.writeFile(e,JSON.stringify(this.ds[t]),function(e){e?console.error(e):console.log("File has been created")})}},{key:"loadAnalysis",value:function(e,t){return this.ds[t]=JSON.parse(o.readFileSync(e,"utf8")),console.log("File '".concat(e,"' has been loaded to bank ").concat(t,".")),this.ds[t].cntGames}},{key:"generateHeatmap",value:function(e,t,i){for(var r=n.default.algebraicToCoords(t),s=[],o=0,a=1e5,l=0;l<8;l+=1){for(var c=new Array(8),u=0;u<8;u+=1)c[u]=i(this.ds[e],r,[l,u]),c[u]>o&&(o=c[u]),c[u]<a&&(a=c[u]);s.push(c)}return[s,a,o]}},{key:"generateComparisonHeatmap",value:function(e,t,i,n){for(var r=[],s=0,o=1e5,a=this.generateHeatmap(e,i,n),l=this.generateHeatmap(t,i,n),c=0;c<8;c+=1){for(var u=new Array(8),f=0;f<8;f+=1){var h=a[0][c][f],p=l[0][c][f];u[f]=0===h||0===p?0:100*(h>=p?h/p-1:-p/h+1),u[f]>s&&(s=u[f]),u[f]<o&&(o=u[f])}r.push(u)}return[r,o,s]}}],[{key:"generateList",value:function(e){for(var t=[],i=0;i<8;i+=1)for(var n=0;n<8;n+=1){var r=e[i][n];r=r.toFixed(2),Math.abs(r)>.001&&(0===i?t.push(["b".concat(l[n]),r]):1===i?t.push(["b".concat(a[n]),r]):6===i?t.push(["w".concat(a[n]),r]):7===i&&t.push(["w".concat(l[n]),r]))}return t.sort(function(e,t){return t[1]-e[1]}),t}}]),e}();t.default=c,e.exports=t.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Chessalyzer",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"ChessBoard",{enumerable:!0,get:function(){return r.default}});var n=s(i(8)),r=s(i(0));function s(e){return e&&e.__esModule?e:{default:e}}}]);
//# sourceMappingURL=chessalyzer.min.js.map